<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.15">
<title>Лучшие практики тестирования на Java</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:50%;border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1>Лучшие практики тестирования на Java</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Поддерживаемый и читаемый тестовый код имеет решающее значение для обеспечения хорошего тестового покрытия, которое, в свою очередь, позволяет внедрять новые функции и выполнять рефакторинг, не опасаясь что-то сломать. Некоторые рекомендации могут быть очевидны для, но некоторые могут противоречить тому, что можно прочитать в книгах о разработке и тестировании программного обеспечения.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_too_long_didnt_read_tldr">Too Long; Didn&#8217;t Read (TL;DR)</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Пишите небольшие и специфические тесты, активно используя вспомогательные функции, параметризованные тесты, мощные утверждения <strong>AssertJ</strong>, не злоупотребляя переменными, проверяя только то, что имеет значение, и избегайте одного теста для всех пограничных случаев.</p>
</li>
<li>
<p>Пишите автономные тесты, раскрывая все соответствующие параметры, вставляйте данные прямо в тест и предпочитайте композицию наследованию.</p>
</li>
<li>
<p>Пишите тупые тесты, избегая повторного использования производственного кода и сосредотачиваясь на сравнении выходных значений с жестко заданными значениями.</p>
</li>
<li>
<p><strong>KISS</strong> &gt; <strong>DRY</strong></p>
</li>
<li>
<p>Тестируйте в окружении близком к производству, сосредотачиваясь на тестировании всей функции, в том числе всех ее слоев, и избегайте использования <strong>in-memory DB</strong>.</p>
</li>
<li>
<p><strong>JUnit5</strong> и <strong>AssertJ</strong> - очень хороший выбор.</p>
</li>
<li>
<p>Инвестируйте в тестируемую реализацию, избегая статического доступа, используя внедрение по средствам конструктора, используя <strong>Clock</strong> и отделяйте синхронную бизнес-логику от асинхронного выполнения.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_главное">Главное</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_given_when_then">Given, When, Then</h3>
<div class="paragraph">
<p>Тест должен содержать три блока, разделенных одной пустой строкой. Каждый блок кода должен быть как можно короче. Используйте вспомогательные методы, чтобы сократить эти блоки.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Given</strong> (<strong>Input</strong>): подготовка к тесту, например создание данных или настройка макетов</p>
</li>
<li>
<p><strong>When</strong> (<strong>Action</strong>): вызовите метод или действие, которое вы хотите протестировать.</p>
</li>
<li>
<p><strong>Then</strong> (<strong>Output</strong>): выполнить <strong>assertions</strong>, чтобы проверить правильность вывода или поведения действия.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Do
@Test
public void findProduct() {
    insertIntoDatabase(new Product(100, "Smartphone"));

    Product product = dao.findProduct(100);

    assertThat(product.getName()).isEqualTo("Smartphone");
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_используйте_префиксы_actual_и_expected">Используйте префиксы <code>actual*</code> и <code>expected*</code>.</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Don't
ProductDTO product1 = requestProduct(1);

ProductDTO product2 = new ProductDTO("1", List.of(State.ACTIVE, State.REJECTED))
assertThat(product1).isEqualTo(product2);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Если вы собираетесь использовать переменные в утверждении равенства, поставьте перед переменными префикс <code>actual*</code> и <code>expected*</code>. Это увеличивает удобочитаемость и проясняет назначение переменной. Более того, их сложнее перепутать в <strong>assertions</strong> равенства.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Do
ProductDTO actualProduct = requestProduct(1);

ProductDTO expectedProduct = new ProductDTO("1", List.of(State.ACTIVE, State.REJECTED))
assertThat(actualProduct).isEqualTo(expectedProduct); // nice and clear.</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_используйте_фиксированные_данные_вместо_случайных_данных">Используйте фиксированные данные вместо случайных данных</h3>
<div class="paragraph">
<p>Избегайте случайных данных, так как это может привести к:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>переключению тестов, которые может быть сложно отладить</p>
</li>
<li>
<p>пропуску сообщений об ошибках, которые затрудняют отслеживание ошибки до кода.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Don't
Instant ts1 = Instant.now(); // 1557582788
Instant ts2 = ts1.plusSeconds(1); // 1557582789
int randomAmount = new Random().nextInt(500); // 232
UUID uuid = UUID.randomUUID(); // d5d1f61b-0a8b-42be-b05a-bd458bb563ad</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вместо этого используйте фиксированные значения для всего, потому что они будут создавать:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Легко воспроизводимые тесты, которые легко отлаживать.</p>
</li>
<li>
<p>Сообщения об ошибках, которые можно легко отследить до соответствующей строки кода.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Do
Instant ts1 = Instant.ofEpochSecond(1550000001);
Instant ts2 = Instant.ofEpochSecond(1550000002);
int amount = 50;
UUID uuid = UUID.fromString("00000000-000-0000-0000-000000000001");</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_пишите_небольшие_и_узкоспециализированные_тесты">Пишите небольшие и узкоспециализированные тесты</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_активно_используйте_вспомогательные_функции">Активно используйте вспомогательные функции</h3>
<div class="paragraph">
<p>Извлеките детали или повторяющийся код в подфункции и дайте им описательное имя. Это мощное средство, позволяющее сделать тесты короткими, а основы теста легкими для понимания с первого взгляда.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Don't
@Test
public void categoryQueryParameter() throws Exception {
    List&lt;ProductEntity&gt; products = List.of(
            new ProductEntity().setId("1").setName("Envelope").setCategory("Office")
                    .setDescription("An Envelope").setStockAmount(1),
            new ProductEntity().setId("2").setName("Pen").setCategory("Office")
                    .setDescription("A Pen").setStockAmount(1),
            new ProductEntity().setId("3").setName("Notebook").setCategory("Hardware")
                    .setDescription("A Notebook").setStockAmount(2)
    );
    for (ProductEntity product : products) {
        template.execute(createSqlInsertStatement(product));
    }

    String responseJson = client.perform(get("/products?category=Office"))
            .andExpect(status().is(200))
            .andReturn().getResponse().getContentAsString();

    assertThat(toDTOs(responseJson))
            .extracting(ProductDTO::getId)
            .containsOnly("1", "2");
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Do
@Test
public void categoryQueryParameter2() throws Exception {
    insertIntoDatabase(
            createProductWithCategory("1", "Office"),
            createProductWithCategory("2", "Office"),
            createProductWithCategory("3", "Hardware")
    );

    String responseJson = requestProductsByCategory("Office");

    assertThat(toDTOs(responseJson))
            .extracting(ProductDTO::getId)
            .containsOnly("1", "2");
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Используйте <strong>вспомогательные функции</strong> для создания данных/объектов (e.g.: <code>createProductWithCategory()</code>) и сложных утверждений. Передавайте вспомогательным функциям только те параметры, которые имеют отношение к вашим тестам. Используйте разумные значения по умолчанию для других значений. В Kotlin это легко сделать с помощью аргументов по умолчанию. В Java вы должны использовать цепочку методов и перегрузку для имитации аргументов по умолчанию.</p>
</li>
<li>
<p><strong>varargs</strong> может сделать ваш тестовый код еще более лаконичным (e.g.: <code>ìnsertIntoDatabase()</code>).</p>
</li>
<li>
<p><strong>Вспомогательные функции</strong> также можно использовать для более простого создания простых значений. Это очень удобно в <strong>Kotlin</strong>, где для этого можно использовать <strong>функции расширения</strong>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Do (Java)
var ts = toInstant(1); // Instant.ofEpochSecond(1550000001)
var id = toUUID(1); // UUID.fromString("00000000-0000-0000-a000-000000000001")</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">// Do (Kotlin)
val ts = 1.toInstant()
val id = 1.toUUID()</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Вспомогательные функции</strong> могут быть реализованы в <strong>Kotlin</strong> следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun Int.toInstant(): Instant = Instant.ofEpochSecond(this.toLong())

fun Int.toUUID(): UUID = UUID.fromString("00000000-0000-0000-a000-${this.toString().padStart(11, '0')}")</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_не_злоупотребляйте_переменными">Не злоупотребляйте переменными</h3>
<div class="paragraph">
<p>Обычный рефлекс разработчика — извлекать значения, которые многократно используются, в переменные.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Don't
@Test
public void variables() throws Exception {
    String relevantCategory = "Office";
    String id1 = "4243";
    String id2 = "1123";
    String id3 = "9213";
    String irrelevantCategory = "Hardware";
    insertIntoDatabase(
        createProductWithCategory(id1, relevantCategory),
        createProductWithCategory(id2, relevantCategory),
        createProductWithCategory(id3, irrelevantCategory)
    );

    String responseJson = requestProductsByCategory(relevantCategory);

    assertThat(toDTOs(responseJson))
            .extracting(ProductDTO::getId)
            .containsOnly(id1, id2);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>К сожалению, это значительно раздувает тестовый код. Более того, учитывая сообщение об ошибке теста, сложнее понять в какой строчке кода проблема.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<strong>KISS</strong> &gt; <strong>DRY</strong>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Do
@Test
public void variables() throws Exception {
    insertIntoDatabase(
        createProductWithCategory("4243", "Office"),
        createProductWithCategory("1123", "Office"),
        createProductWithCategory("9213", "Hardware")
    );

    String responseJson = requestProductsByCategory("Office");

    assertThat(toDTOs(responseJson))
            .extracting(ProductDTO::getId)
            .containsOnly("4243", "1123");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Если сделать тесты маленькими, что очень рекомендуется, то легко увидеть, где используются те же значения. Кроме того, тестовый метод будет еще короче и поэтому его будет легче понять. Так же будет легче отследить код, содержащий ошибку, используя сообщения об ошибках.</p>
</div>
</div>
<div class="sect2">
<h3 id="_не_расширяйте_существующие_тесты_чтобы_просто_протестировать_еще_одну_маленькую_вещь">Не расширяйте существующие тесты, чтобы «просто протестировать еще одну маленькую вещь»</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Don't
public class ProductControllerTest {
    @Test
    public void happyPath() {
        // a lot of code comes here...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Заманчиво добавить угловой тест к существующему тесту (счастливый путь). Но этот тест становится все сложнее и сложнее. Становится трудно понять все соответствующие тестовые случаи, которые охватываются этим большим тестом. Вы можете определить эти тесты по общим названиям, например, «тест счастливого пути». Если этот тест не пройден, трудно понять, что именно сломано.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Do
public class ProductControllerTest {
    @Test
    public void multipleProductsAreReturned() {
    }

    @Test
    public void allProductValuesAreReturned() {
    }

    @Test
    public void filterByCategory() {
    }

    @Test
    public void filterByDateCreated() {
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вместо этого создайте новый тестовый метод с описательным именем, которое расскажет все об ожидаемом поведении. Да, это больше усилий, но зато можно создать индивидуальный и понятный тест, который проверяет только соответствующее поведение. Опять же, <strong>вспомогательные функции</strong> могут снизить трудоемкость. И, наконец, добавление специализированных тестов с описательными именами — отличный способ документировать реализованное поведение.</p>
</div>
</div>
<div class="sect2">
<h3 id="_проверяйте_только_то_что_нужно_протестировать">Проверяйте только то, что нужно протестировать</h3>
<div class="paragraph">
<p>Подумайте, что вы действительно хотите протестировать. Не нужно проверять все случаи только потому, что вы можете это сделать. Более того, нужно иметь в виду то, что уже тестировалось в предыдущих тестах; нет нужды проверять это снова и снова в каждом тесте. Это делает тесты короткими, четкими и явно указывает ожидаемое поведение.</p>
</div>
<div class="paragraph">
<p>Рассмотрим пример: тестирование HTTP endpoint, который возвращает продукты. Набор тестов должен содержать следующие тесты:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Крупный «тест сопоставления», который проверяет, что все значения из базы данных правильно возвращаются как JSON и правильно отображаются в правильный формат. Это можно легко сделать, используя <strong>AssertJ</strong>, если <code>equals()</code> реализован правильно:</p>
<div class="ulist">
<ul>
<li>
<p><code>isEqualTo()</code> - для одного элемента</p>
</li>
<li>
<p><code>containsOnly()</code> - для нескольких элементов.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">String responseJson = requestProducts();

ProductDTO expectedDTO1 = new ProductDTO("1", "evelope", new Category("office"),
                                List.of(States.ACTIVE, States.REJECTED));
ProductDTO expectedDTO2 = new ProductDTO("2", "evelope", new Category("smartphone"),
                                List.of(States.ACTIVE));

assertThat(toDTOs(responseJson))
        .containsOnly(expectedDTO1, expectedDTO2);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Тест, проверяющие правильность поведения параметра запроса <code>?category</code>. Итак, нужно проверить правильность фильтрации, для этого не нужно проверять что все свойства установлены правильно. Это уже сделано в приведенном выше тесте. Следовательно, достаточно сравнить только возвращенные идентификаторы товаров.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">String responseJson = requestProductsByCategory("Office");

assertThat(toDTOs(responseJson))
        .extracting(ProductDTO::getId)
        .containsOnly("1", "2");</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Тесты, проверяющие пограничные случаи или специальную бизнес-логику. Например, проверка правильности значений, которые высчитываются. В этом случае интересно только определенное поле в JSON. Поэтому необходимо проверить только соответствующее поле, чтобы четко указать и задокументировать объем тестируемой логики. Опять же, нет необходимости снова проверять все поля, потому что это проверяется не здесь.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">assertThat(actualProduct.getPrice()).isEqualTo(100);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_автономные_тесты">Автономные тесты</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_не_скрывайте_соответствующие_параметры_во_вспомогательных_методах">Не скрывайте соответствующие параметры (во вспомогательных методах)</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Don't
insertIntoDatabase(createProduct());
List&lt;ProductDTO&gt; actualProducts = requestProductsByCategory();
assertThat(actualProducts).containsOnly(new ProductDTO("1", "Office"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Необходимо использовать вспомогательные функции для создания данных и <strong>asserts</strong>, но нужно параметризовать их. Определите параметр для всего, что важно для теста и это должно контролироваться из теста, а не вспомогательного метода. Не заставляйте того, кто читает тест, переходить во вспомогательный метод, чтобы понять тест. Эмпирическое правило: необходимо понимать суть теста, глядя только на тестовый метод.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Do
insertIntoDatabase(createProduct("1", "Office"));
List&lt;ProductDTO&gt; actualProducts = requestProductsByCategory("Office");
assertThat(actualProducts).containsOnly(new ProductDTO("1", "Office"));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_вставьте_тестовые_данные_прямо_в_тестовый_метод">Вставьте тестовые данные прямо в тестовый метод</h3>
<div class="paragraph">
<p>В методе тестирования все должно быть правильно. Заманчиво переместить в <code>@Before</code> метод повторно используемый код для вставки данных, но это заставит читателя перейти в этот метод, чтобы полностью понять, что происходит. Вспомогательные методы для вставки данных могут помочь сделать эту повторяющуюся задачу в одну строку.</p>
</div>
</div>
<div class="sect2">
<h3 id="_предпочитайте_композицию_над_наследованием">Предпочитайте композицию над наследованием</h3>
<div class="paragraph">
<p>Не создавайте сложные иерархии наследования для тестовых классов.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Don't
class SimpleBaseTest {}
class AdvancedBaseTest extends SimpleBaseTest {}
class AllInclusiveBaseTest extends AdvancedBaseTest {}
class MyTest extends AllInklusiveBaseTest {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Эти иерархии трудно понять, и в конечном итоге, произойдет расширение базового теста. Базовый тест и так содержит много вещей, которые текущему тесту не нужны. Это будет отвлекать при написании тестов и может привести к ошибкам. Наследование не является гибким: навряд ли понадобиться использовать все возможности <code>AllInclusiveBaseTest</code> и его superclass <code>AdvancedBaseTest</code>. Более того, приходится переключаться между несколькими базовыми классами, чтобы понять общую картину.</p>
</div>
<div class="quoteblock">
<blockquote>
Предпочитайте дублирование неправильной абстракции
</blockquote>
<div class="attribution">
&#8212; Sandi Metz<br>
<cite>Wall of Coding Wisdom</cite>
</div>
</div>
<div class="paragraph">
<p>Вместо этого следует использовать композицию. Напишите небольшие фрагменты кода и классы для каждой конкретной задачи (например: запустите тестовую базу данных, создайте схему, вставьте данные, запустите фиктивный веб-сервер). Повторно используйте эти части в своих тестах в <code>@BeforeAll</code> методе или назначив созданные объекты полям тестового класса. Таким образом, каждый новый тестовый класс собирается повторно использовав эти части, как кубики лего. Таким образом, каждый тест имеет свой собственный состав, его легко понять и в нем нет ничего лишнего. Тестовый класс самодостаточен, потому что все необходимое находится прямо в тестовом классе.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Do
public class MyTest {
    // composition instead of inheritance
    private JdbcTemplate template;
    private MockWebServer taxService;

    @BeforeAll
    public void setupDatabaseSchemaAndMockWebServer() throws IOException {
        this.template = new DatabaseFixture().startDatabaseAndCreateSchema();
        this.taxService = new MockWebServer();
        taxService.start();
    }
}

// In a different File
public class DatabaseFixture {
    public JdbcTemplate startDatabaseAndCreateSchema() throws IOException {
        PostgreSQLContainer db = new PostgreSQLContainer("postgres:11.2-alpine");
        db.start();
        DataSource dataSource = DataSourceBuilder.create()
                .driverClassName("org.postgresql.Driver")
                .username(db.getUsername())
                .password(db.getPassword())
                .url(db.getJdbcUrl())
                .build();
        JdbcTemplate template = new JdbcTemplate(dataSource);
        SchemaCreator.createSchema(template);
        return template;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Очередной раз:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<strong>KISS</strong> &gt; <strong>DRY</strong>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_тупые_тесты_это_хорошо_сравнивайте_результат_с_жестко_заданными_значениями">Тупые тесты — это хорошо: сравнивайте результат с жестко заданными значениями</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_не_используйте_производственный_код_в_тестовом">Не используйте производственный код в тестовом</h3>
<div class="paragraph">
<p>Тест должен тестировать производственный код, а не использовать его повторно. Если повторно использовать производственный код в тесте, то можно пропустить ошибку, которая совершена в производственном коде и используется в тестируемом. Это происходит потому что код, который должен тестироваться, сам используется для тестирования.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Don't
boolean isActive = true;
boolean isRejected = true;
insertIntoDatabase(new Product(1, isActive, isRejected));

ProductDTO actualDTO = requestProduct(1);

// production code reuse ahead
List&lt;State&gt; expectedStates = ProductionCode.mapBooleansToEnumList(isActive, isRejected);
assertThat(actualDTO.states).isEqualTo(expectedStates);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вместо этого, при написании тестов, необходимо думать о <strong>Input</strong> и <strong>Output</strong>. Тест устанавливает <strong>input</strong> данные и сравнивает <strong>actual</strong> <strong>output</strong> данные с жестко заданными <strong>expected</strong> значениями. В большинстве случаев повторное использование кода не требуется.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Do
assertThat(actualDTO.states).isEqualTo(List.of(States.ACTIVE, States.REJECTED));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_не_переписывайте_производственную_логику">Не переписывайте производственную логику</h3>
<div class="paragraph">
<p>Маппинг — это типичный пример, когда логика тестов переписывается. Например: тест содержит метод <code>mapEntityToDto()</code>. Результат этого метода используется для <strong>assert</strong>, который проверяет, что возвращенный <strong>DTO</strong> содержит те же значения, что и вставленные в начале теста сущности. В этом случае скорее всего, захочется написать такую же логику, как и в производственную коде, а этот код может содержать ошибки.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Don't
ProductEntity inputEntity = new ProductEntity(1, "evelope", "office", false, true, 200, 10.0);
insertIntoDatabase(input);

ProductDTO actualDTO = requestProduct(1);

// mapEntityToDto() contains the same mapping logic as the production code
ProductDTO expectedDTO = mapEntityToDto(inputEntity);
assertThat(actualDTO).isEqualTo(expectedDTO);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Решением, для этого случая, является сравнение <code>actualDTO</code> с созданным вручную ссылочным объектом с жестко заданными значениями. Это предельно просто, легко понимается и менее подвержено ошибкам.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Do
ProductDTO expectedDTO = new ProductDTO("1", "evelope", new Category("office"), List.of(States.ACTIVE, States.REJECTED))
assertThat(actualDTO).isEqualTo(expectedDTO);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Если не нужно сравнивать все значения и не хочется создавать полный объект ссылки, то можно сравнивать только подобъекты или только соответствующие значения.</p>
</div>
</div>
<div class="sect2">
<h3 id="_не_пишите_слишком_много_логики">Не пишите слишком много логики</h3>
<div class="paragraph">
<p>Тестирование в основном касается <strong>input</strong> и <strong>output: предоставление *input</strong> данных и сравнение <strong>actual</strong> <strong>output</strong> с <strong>expected</strong> значениями. Следовательно, не нужно писать много логики в тестах. Если реализуется логика с большим количеством циклов и условий, то тесты станут сложнее для понимания и более подвержены ошибкам. Более того, в случае сложной логики проверки, <strong>AssertJ</strong> может сделать всю тяжелую работу.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_тест_близок_к_реальности">Тест близок к реальности</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_сосредоточьтесь_на_тестировании_полного_вертикального_слайда">Сосредоточьтесь на тестировании полного вертикального слайда</h3>
<div class="paragraph">
<p>Обычно рекомендуется тестировать каждый класс изолированно с помощью <strong>mocks</strong>. Однако у него есть недостатки:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>не тестируются все классы при интеграции</p>
</li>
<li>
<p>рефакторинг компонентов сломает все тесты, где они используются в качестве <strong>mocks</strong></p>
</li>
<li>
<p>необходимо написать и поддерживать несколько тестов</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../../assets/img/java/tools/mock-based-testing.svg" alt="Модульное тестирование каждого класса изолированно и с помощью имитаций">
</div>
<div class="title">Figure 1. Модульное тестирование каждого класса изолированно и с помощью <strong>mocks</strong> имеет недостатки</div>
</div>
<div class="paragraph">
<p>Поэтому лучше сосредоточиться на <strong>интеграционных тестах</strong>. Под <strong>интеграционными тестами</strong> (или <strong>тестированием компонентов</strong>) имеется в виду объединение всех классов (как в производственной среде) и тестирование полного вертикального вызова, проходящего через все технические уровни (HTTP, бизнес-логика, база данных). Таким образом, тестируется поведение, а не реализацию. Эти тесты близки к производственным и устойчивы к рефакторингу внутренних компонентов. В идеале нужно написать только один тестовый класс.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../assets/img/java/tools/integration-test.svg" alt="Интеграционное тестирование (= соединение реальных объектов вместе и тестирование всех сразу)">
</div>
<div class="title">Figure 2. Интеграционное тестирование (соединение реальных объектов вместе и тестирование всех сразу)</div>
</div>
<div class="paragraph">
<p>Тем не менее, модульные тесты полезны, и бывают ситуации, когда модульный тест является лучшим выбором или когда имеет смысл комбинировать оба подхода. Но в большинстве случаев интеграционный тест является лучшим и достаточным выбором.</p>
</div>
</div>
<div class="sect2">
<h3 id="_не_используйте_базы_данных_в_памяти_для_тестов">Не используйте базы данных в памяти для тестов</h3>
<div class="imageblock">
<div class="content">
<img src="../../assets/img/java/tools/in-memory-database-vs-real-database-tests.svg" alt="База данных для тестов против базы данных для производства">
</div>
<div class="title">Figure 3. Используя базу данных в памяти, проводиться тестирование с другой базой данных, чем та, которая используется в производственной среде.</div>
</div>
<div class="paragraph">
<p>Использование <strong>in-memory DB</strong> (<strong>H2</strong>, <strong>HSQLDB</strong>, <strong>Fongo</strong>) для тестов снижает надежность и объем тестов. <strong>In-memory DB</strong> и <strong>DB</strong>, используемая в производственной среде, ведут себя по-разному и могут возвращать разные результаты. Таким образом, правильный (зеленый/<strong>green</strong>) тест на основе <strong>in-memory DB</strong> не является гарантией правильного поведения приложения в производственной среде. Более того, можно легко столкнуться с ситуациями, когда нельзя использовать (или протестировать) определенную (специфичную для базы данных) функцию, потому что <strong>in-memory DB</strong> не поддерживает ее или действует иначе.</p>
</div>
<div class="paragraph">
<p>Решение состоит в том, чтобы выполнить тесты на реальной базе данных. К счастью, библиотека <strong>Testcontainers</strong> предоставляет отличный Java API для управления контейнером прямо в тестовом коде.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_java_jvm">Java / JVM</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_используйте_noverify_xxtieredstopatlevel1">Используйте <code>-noverify -XX:TieredStopAtLevel=1</code></h3>
<div class="paragraph">
<p>Всегда добавляйте параметры <strong>JVM</strong> <code>-noverify -XX:TieredStopAtLevel=1</code> в конфигурации запуска. Это сэкономит 1-2 секунды при запуске <strong>JVM</strong> до выполнения теста. Это особенно полезно во время первоначальной разработки теста, когда часто запускаются тесты через <strong>IDE</strong>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Начиная с Java 13, <code>-noverify</code> не рекомендуется.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Можно добавить аргументы в шаблон конфигурации запуска <em>JUnit</em> в <em>IntelliJ IDEA</em>, чтобы не приходилось добавлять их для каждой новой конфигурации запуска.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../../assets/img/java/tools/idea-run-config-template-default-vm-options-marked.png" alt="Run tests with IntelliJ IDEA settings">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_используйте_assertj">Используйте <code>AssertJ</code></h3>
<div class="paragraph">
<p><a href="http://joel-costigliola.github.io/assertj/">AssertJ</a> - чрезвычайно мощная и зрелая библиотека <strong>asserts</strong> с удобным типо-безопасным API, огромным разнообразием <strong>asserts</strong> и описательных сообщений об ошибках. Есть <strong>asserts</strong> для всего, что необходимо сделать. Это не дает писать сложную логику <strong>asserts</strong> с циклами и условиями, сохраняя при этом тестовые методы короткими. Вот некоторые примеры:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">assertThat(actualProduct)
        .isEqualToIgnoringGivenFields(expectedProduct, "id");

assertThat(actualProductList).containsExactly(
    createProductDTO("1", "Smartphone", 250.00),
    createProductDTO("1", "Smartphone", 250.00)
);

assertThat(actualProductList)
        .usingElementComparatorIgnoringFields("id")
        .containsExactly(expectedProduct1, expectedProduct2);

assertThat(actualProductList)
        .extracting(Product::getId)
        .containsExactly("1", "2");

assertThat(actualProductList)
        .anySatisfy(product -&gt; assertThat(product.getDateCreated())
                .isBetween(instant1, instant2));

assertThat(actualProductList)
        .filteredOn(product -&gt; product.getCategory().equals("Smartphone"))
        .allSatisfy(product -&gt; assertThat(product.isLiked()).isTrue());</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_избегайте_asserttrue_и_assertfalse">Избегайте <code>assertTrue()</code> и <code>assertFalse()</code></h3>
<div class="paragraph">
<p>Избегайте простых <code>assertTrue()</code> или <code>assertFalse()</code> <strong>asserts</strong>, поскольку они выдают загадочные сообщения об ошибках:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Don't
assertTrue(actualProductList.contains(expectedProduct));
assertTrue(actualProductList.size() == 5);
assertTrue(actualProduct instanceof Product);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>expected: &lt;true&gt; but was: &lt;false&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Вместо этого используйте <strong>asserts</strong> из <strong>AssertJ</strong>, которые сразу же создают понятные сообщения об ошибках.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Do
assertThat(actualProductList).contains(expectedProduct);
assertThat(actualProductList).hasSize(5);
assertThat(actualProduct).isInstanceOf(Product.class);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>Expecting:
&lt;[Product[id=1, name='Samsung Galaxy']]&gt;
to contain:
&lt;[Product[id=2, name='iPhone']]&gt;
but could not find:
&lt;[Product[id=2, name='iPhone']]&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Если действительно нужно проверить логическое значение, необходимо подумать о <strong>AssertJ</strong>, чтобы улучшить сообщение об ошибке.</p>
</div>
</div>
<div class="sect2">
<h3 id="_используйте_junit_5">Используйте JUnit 5</h3>
<div class="paragraph">
<p><strong>JUnit 5</strong> - это новейший продукт для (модульного) тестирования. Он активно развивается и предоставляет множество мощных функций (например, параметризованные тесты, группирование, условные тесты, управление жизненным циклом).</p>
</div>
<div class="sect3">
<h4 id="_используйте_параметризованные_тесты">Используйте параметризованные тесты</h4>
<div class="paragraph">
<p><strong>Параметризованные тесты</strong> позволяют повторно запускать один тест несколько раз с разными значениями. Таким образом, можно легко протестировать несколько случаев без написания тестового кода. <strong>JUnit 5</strong> предоставляет большое количество средств, чтобы написать эти тесты с <code>@ValueSource</code>, <code>@EnumSource</code>, <code>@CsvSource</code> и <code>@MethodSource</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Do
@ParameterizedTest
@ValueSource(strings = ["§ed2d", "sdf_", "123123", "§_sdf__dfww!"])
public void rejectedInvalidTokens(String invalidToken) {
    client.perform(get("/products")
            .param("token", invalidToken))
            .andExpect(status().is(400))
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@ParameterizedTest
@EnumSource(WorkflowState::class, mode = EnumSource.Mode.INCLUDE, names = ["FAILED", "SUCCEEDED"])
public void dontProcessWorkflowInCaseOfAFinalState(WorkflowState itemsInitialState) {
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Таким образом, желательно использовать параметризованные тесты, потому что можно протестировать больше случаев с минимальными усилиями.</p>
</div>
<div class="paragraph">
<p>Так же рекомендуется использовать <code>@CsvSource</code> и <code>@MethodSource</code>, которые можно использовать для более сложных сценариев параметризованного тестирования, где вы также можете контролировать ожидаемый результат с помощью параметра.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@ParameterizedTest
@CsvSource({
    "1, 1, 2",
    "5, 3, 8",
    "10, -20, -10"
})
public void add(int summand1, int summand2, int expectedSum) {
    assertThat(calculator.add(summand1, summand2)).isEqualTo(expectedSum);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@MethodSource</code> - является мощным в сочетании со специальным тестовым объектом, содержащим все соответствующие тестовые параметры и ожидаемый результат.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">class TestData {
    String input;
    Token expected;
}

@ParameterizedTest
@MethodSource("validTokenProvider")
void parseValidTokens(TestData data) {
    assertThat(parse(data.input)).isEqualTo(data.expected);
}

static Stream&lt;Arguments&gt; validTokenProvider() {
    return Stream.of(
            Arguments.of(new TestData("1511443755_2", new Token(1511443755, "2"))),
            Arguments.of(new TestData("151175_13521", new Token(151175, "13521"))),
            Arguments.of(new TestData("151144375_id", new Token(151144375, "id"))),
            Arguments.of(new TestData("15114437599_1", new Token(15114437599, "1"))),
            Arguments.of(new TestData(null, null))
    );
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_сгруппируйте_тесты">Сгруппируйте тесты</h3>
<div class="paragraph">
<p><code>@Nested</code> полезен для группировки методов тестирования. Полезной группировкой может быть группировка по типам тестов (например: <code>InputIsXY</code>, <code>ErrorCases</code>) или одна группа для каждого тестируемого метода (<code>GetDesign</code> и <code>UpdateDesign</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class DesignControllerTest {
    @Nested
    class GetDesigns {
        @Test
        void allFieldsAreIncluded() {}

        @Test
        void limitParameter() {}

        @Test
        void filterParameter() {}
    }

    @Nested
    class DeleteDesign {
        @Test
        void designIsRemovedFromDb() {}

        @Test
        void return404OnInvalidIdParameter() {}

        @Test
        void return401IfNotAuthorized() {}
    }
}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../../assets/img/java/tools/group-test-methods.png" alt="Сгруппируйте методы тестирования с помощью `@Nested`">
</div>
<div class="title">Figure 4. Сгруппируйте методы тестирования с помощью <code>@Nested</code></div>
</div>
</div>
<div class="sect2">
<h3 id="_читаемые_имена_тестов_с_displayname_или_обратными_кавычками_kotlin">Читаемые имена тестов с <code>@DisplayName</code> или обратными кавычками Kotlin</h3>
<div class="paragraph">
<p>В Java используйте <code>@DisplayName</code> для создания читаемых описаний тестов.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class DisplayNameTest {
    @Test
    @DisplayName("Design is removed from database")
    void designIsRemoved() {}

    @Test
    @DisplayName("Return 404 in case of an invalid parameter")
    void return404() {}

    @Test
    @DisplayName("Return 401 if the request is not authorized")
    void return401() {}
}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../../assets/img/java/tools/annotation-display-name.png" alt="Читаемые имена тестовых методов с использованием `@DisplayName`">
</div>
<div class="title">Figure 5. Читаемые имена методов тестирования с использованием <code>@DisplayName</code></div>
</div>
<div class="paragraph">
<p>В <strong>Kotlin</strong> можно помещать имена методов в обратные кавычки, которые могут содержать пробелы. Это обеспечивает хорошую читаемость без избыточности.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Test
fun `design is removed from db`() {}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_имитация_удаленной_службы">Имитация удаленной службы</h3>
<div class="paragraph">
<p>Чтобы протестировать HTTP-клиентов, нужно имитировать удаленный сервис. Для этой цели часто используют <a href="https://github.com/square/okhttp/tree/master/mockwebserver">OkHttp&#8217;s WebMockServer</a>. Альтернативы - <a href="http://wiremock.org/">WireMock</a> или <a href="https://www.testcontainers.org/modules/mockserver/">Mockserver Testcontainer</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">MockWebServer serviceMock = new MockWebServer();
serviceMock.start();
HttpUrl baseUrl = serviceMock.url("/v1/");
ProductClient client = new ProductClient(baseUrl.host(), baseUrl.port());
serviceMock.enqueue(new MockResponse()
        .addHeader("Content-Type", "application/json")
        .setBody("{\"name\": \"Smartphone\"}"));

ProductDTO productDTO = client.retrieveProduct("1");

assertThat(productDTO.getName()).isEqualTo("Smartphone");</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_используйте_awaitility_для_asserts_асинхронного_кода">Используйте Awaitility для asserts асинхронного кода</h3>
<div class="paragraph">
<p><a href="https://github.com/awaitility/awaitility">Awaitility</a> - это библиотека для тестирования асинхронного кода. Вы можете легко определить, как часто <strong>assert</strong> будет повторяться до тех пор, пока окончательно не завершится ошибкой.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">private static final ConditionFactory WAIT = await()
        .atMost(Duration.ofSeconds(6))
        .pollInterval(Duration.ofSeconds(1))
        .pollDelay(Duration.ofSeconds(1));

@Test
public void waitAndPoll(){
    triggerAsyncEvent();
    WAIT.untilAsserted(() -&gt; {
        assertThat(findInDatabase(1).getState()).isEqualTo(State.SUCCESS);
    });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Таким образом, можно избежать использования <code>Thread.sleep()</code> в тестах.</p>
</div>
<div class="paragraph">
<p>Однако тестировать синхронный код намного проще. Вот почему необходимо попытаться разделить синхронный и асинхронный код, чтобы протестировать их отдельно.</p>
</div>
</div>
<div class="sect2">
<h3 id="_нет_необходимости_загружать_di_spring">Нет необходимости загружать DI (Spring)</h3>
<div class="paragraph">
<p><strong>Bootstrapping</strong> (<strong>Spring</strong>) <strong>DI</strong> занимает несколько секунд, прежде чем можно будет начать тест. Это замедляет цикл обратной связи, особенно на начальном этапе разработки теста.</p>
</div>
<div class="paragraph">
<p>Вот почему не стоит использовать <strong>DI</strong> в своих интеграционных тестах. Можно создавать экземпляры требуемых объектов вручную, вызывая <code>new</code> их и объединяя их вместе. Если использовать инъекцию по средствам конструктора, это очень просто. В большинстве случаев необходимо протестировать написанную бизнес-логику. Для этого не нужен <strong>DI</strong>.</p>
</div>
<div class="paragraph">
<p>Более того, <strong>Spring Boot 2.2</strong> предоставляет простой способ использования ленивой инициализации bean-компонентов, что должно значительно ускорить тесты на основе <strong>DI</strong>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_сделайте_реализацию_тестируемой">Сделайте реализацию тестируемой</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_не_используйте_статический_доступ">Не используйте статический доступ</h3>
<div class="paragraph">
<p><strong>Статический доступ</strong> — это анти-шаблон.</p>
</div>
<div class="paragraph">
<p>Во-первых, он скрывает зависимости и побочные эффекты, что затрудняет понимание всего кода и делает его более подверженным ошибкам.</p>
</div>
<div class="paragraph">
<p>Во-вторых, статический доступ вредит тестируемости, так как нельзя больше подменять значения. Но в тесте хотелось бы использовать <strong>mocks</strong> или реальные объекты с другой конфигурацией (например, объект <strong>DAO</strong>, указывающий на тестовую базу данных).</p>
</div>
<div class="paragraph">
<p>Поэтому вместо статического доступа к коду поместите его в нестатические методы, создайте экземпляр класса и передайте объект конструктору объекта там, где он вам нужен.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Don't
public class ProductController {
    public List&lt;ProductDTO&gt; getProducts() {
        List&lt;ProductEntity&gt; products = ProductDAO.getProducts();
        return mapToDTOs(products);
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Do
public class ProductController {
    private ProductDAO dao;

    public ProductController(ProductDAO dao) {
        this.dao = dao;
    }

    public List&lt;ProductDTO&gt; getProducts() {
        List&lt;ProductEntity&gt; products = dao.getProducts();
        return mapToDTOs(products);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>К счастью, фреймворки <strong>DI</strong>, например <strong>Spring</strong>, предоставляют простой способ избежать статического доступа, поскольку они обрабатывают создание и связывание всех объектов за разработчика.</p>
</div>
</div>
<div class="sect2">
<h3 id="_параметризация">Параметризация</h3>
<div class="paragraph">
<p>Сделайте все соответствующие части класса контролируемыми этим тестом. Это можно сделать, создав параметр для конструктора из этой части.</p>
</div>
<div class="paragraph">
<p>Например, <strong>DAO</strong> имеет фиксированный лимит в 1000 запросов. Для проверки этого ограничения потребуется создать 1001 запись в базе данных. Используя параметр конструктора для этого ограничения, можно сделаете его настраиваемым. В производстве этот параметр равен 1000. В тесте можно использовать 2. Это требует только 3 тестовых записи для тестирования метода ограничения.</p>
</div>
</div>
<div class="sect2">
<h3 id="_используйте_внедрение_через_конструктор">Используйте внедрение через конструктор</h3>
<div class="paragraph">
<p><strong>Field injection</strong> — зло из-за плохой тестируемости. Вы должны сделать <strong>bootstrap</strong> <strong>DI</strong> в тестах или использовать Reflection API. Таким образом, внедрение через конструктор является предпочтительным способом, поскольку оно позволяет легко управлять зависимым объектом в тесте.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Do
public class ProductController {
    private ProductDAO dao;
    private TaxClient client;

    public CustomerResource(ProductDAO dao, TaxClient client) {
        this.dao = dao;
        this.client = client;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>В <strong>Kotlin</strong> то же самое гораздо лаконичнее.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Do
class ProductController(
    private val dao: ProductDAO,
    private val client: TaxClient
) {
    // ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_не_используйте_instant_now_или_new_date">Не используйте <code>Instant.now()</code> или <code>new Date()</code></h3>
<div class="paragraph">
<p>Не получайте текущее время, вызывая <code>Instant.now()</code> или <code>new Date()</code> в производственном коде, если нужно проверить это поведение.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Don't
public class ProductDAO {
    public void updateDateModified(String productId) {
        Instant now = Instant.now(); // !
        Update update = Update().set("dateModified", now);
        Query query = Query().addCriteria(where("_id").eq(productId));
        return mongoTemplate.updateOne(query, update, ProductEntity.class);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Проблема в том, что созданная временная метка не может контролироваться тестом. Нельзя проверять точное значение, потому что оно всегда разное при каждом выполнении теста. Вместо этого можно использовать класс <code>Clock</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Do
public class ProductDAO {
    private Clock clock;

    public ProductDAO(Clock clock) {
        this.clock = clock;
    }

    public void updateProductState(String productId, State state) {
        Instant now = clock.instant();
        // ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>В тесте теперь можно создать <strong>mock</strong> часов, передать его в <code>ProductDAO</code> и настроить <strong>mock</strong> часов, чтобы он возвращал фиксированную метку времени. После вызова <code>updateProductState()</code> проверяется, попала ли указанная временная метка в базу данных.</p>
</div>
</div>
<div class="sect2">
<h3 id="_разделяйте_асинхронное_и_не_асинхронное_выполнение">Разделяйте асинхронное и не асинхронное выполнение</h3>
<div class="paragraph">
<p>Тестировать асинхронный код сложно. Такие библиотеки, как <strong>Awaitility</strong>, могут помочь, но они по-прежнему громоздки, и тесты все еще могут переключаться. Если возможно, имеет смысл отделить (часто синхронную) бизнес-логику от асинхронного выполнения этой логики.</p>
</div>
<div class="paragraph">
<p>Например, поместив бизнес-логику в <code>ProductController</code>, можно протестировать ее синхронно, что легко. <strong>Asynchronous</strong> и <strong>parallelization</strong> логику разместить в <code>ProductScheduler</code>, которую можно тестировать изолированно.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Do
public class ProductScheduler {
    private ProductController controller;

    @Scheduled
    public void start() {
        CompletableFuture&lt;String&gt; usFuture = CompletableFuture.supplyAsync(() -&gt; controller.doBusinessLogic(Locale.US));
        CompletableFuture&lt;String&gt; germanyFuture = CompletableFuture.supplyAsync(() -&gt; controller.doBusinessLogic(Locale.GERMANY));
        String usResult = usFuture.get();
        String germanyResult = germanyFuture.get();
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-06-11 09:13:37 UTC
</div>
</div>
</body>
</html>