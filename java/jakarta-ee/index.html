<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.15">
<meta name="author" content="Dmitry Rakovets">
<title>Java with Jakarta EE</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:50%;border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Java with Jakarta EE</h1>
<div class="details">
<span id="author" class="author">Dmitry Rakovets</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_введение_в_java_ee">1. Введение в Java EE</a>
<ul class="sectlevel2">
<li><a href="#_история_развития">1.1. История развития</a></li>
<li><a href="#_установка_ide">1.2. Установка IDE</a></li>
</ul>
</li>
<li><a href="#_apache_tomcat">2. Apache Tomcat</a>
<ul class="sectlevel2">
<li><a href="#_установка_tomcat">2.1. Установка Tomcat</a></li>
<li><a href="#_структура_apache_tomcat">2.2. Структура Apache Tomcat</a></li>
</ul>
</li>
<li><a href="#_jakarta_servlet">3. Jakarta Servlet</a>
<ul class="sectlevel2">
<li><a href="#_введение_в_сервлеты">3.1. Введение в сервлеты</a></li>
<li><a href="#_как_работает_сервлет">3.2. Как работает сервлет</a></li>
<li><a href="#_получение_данных_в_сервлете">3.3. Получение данных в сервлете</a></li>
<li><a href="#_переадресация_и_перенаправление_запроса">3.4. Переадресация и перенаправление запроса</a></li>
<li><a href="#_web_xml_и_маппинг_сервлетов">3.5. <code>web.xml</code> и маппинг сервлетов</a></li>
<li><a href="#_параметры_инициализации_сервлетов">3.6. Параметры инициализации сервлетов</a></li>
<li><a href="#_обработка_ошибок">3.7. Обработка ошибок</a></li>
<li><a href="#_cookies">3.8. Cookies</a></li>
<li><a href="#_sessions">3.9. Sessions</a></li>
</ul>
</li>
<li><a href="#_jakarta_server_pages">4. Jakarta Server Pages</a>
<ul class="sectlevel2">
<li><a href="#_what_is_jsp">4.1. What is JSP</a></li>
<li><a href="#_jsp_syntax_basics">4.2. JSP syntax basics</a></li>
<li><a href="#_using_java_classes_in_jsp">4.3. Using Java classes in JSP</a></li>
<li><a href="#_вложение_jsp_страниц">4.4. Вложение jsp-страниц</a></li>
<li><a href="#_получение_отправленных_форм">4.5. Получение отправленных форм</a></li>
<li><a href="#_передача_данных_из_сервлета_в_jsp">4.6. Передача данных из сервлета в jsp</a></li>
</ul>
</li>
<li><a href="#_jakarta_standard_tag_library">5. Jakarta Standard Tag Library</a>
<ul class="sectlevel2">
<li><a href="#_jstl">5.1. JSTL</a></li>
<li><a href="#_основные_возможности_jstl">5.2. Основные возможности JSTL</a></li>
</ul>
</li>
<li><a href="#_jakarta_expression_language">6. Jakarta Expression Language</a>
<ul class="sectlevel2">
<li><a href="#_expression_language">6.1. Expression Language</a></li>
<li><a href="#_встроенные_объекты_expression_language">6.2. Встроенные объекты Expression Language</a></li>
</ul>
</li>
<li><a href="#_javabean">7. JavaBean</a>
<ul class="sectlevel2">
<li><a href="#_javabeans">7.1. JavaBeans</a></li>
<li><a href="#_пример_enterprise_javabeans">7.2. Пример Enterprise JavaBeans</a></li>
<li><a href="#_poji_pojo_и_javabean">7.3. POJI, POJO и JavaBean.</a></li>
</ul>
</li>
<li><a href="#_служба_имен_и_каталогов_jndi">8. Служба имен и каталогов JNDI</a>
<ul class="sectlevel2">
<li><a href="#_инициализация_контекста_jndi">8.1. Инициализация контекста JNDI</a></li>
<li><a href="#_поиск_ресурсов_в_jndi_lookup">8.2. Поиск ресурсов в JNDI, lookup</a></li>
<li><a href="#_пример_jndi">8.3. Пример JNDI</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Wiki for course "Java with Jakarta EE".</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_введение_в_java_ee">1. Введение в Java EE</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Java EE</strong> или <strong>Java Enterprise Edition</strong> представляет платформу для создания корпоративных приложений на языке <strong>Java</strong>. Прежде всего это сфера <strong>веб-приложений</strong> и <strong>веб-сервисов</strong>.</p>
</div>
<div class="paragraph">
<p><strong>Java EE</strong> состоит из набора <strong>API</strong> и среды выполнения. Некоторые из <strong>API</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Java Servlets.</strong> Сервлеты представляют специальные модули, которые обрабатывают запросы от пользователей и отправляют результат обработки.</p>
</li>
<li>
<p><strong>JavaServer Pages (JSP).</strong> Также модули на стороне сервера, которые обрабатывают запросы. Удобны для генерации большого контента <strong>HTML</strong>. По сути предствляют собой страницы с кодом <strong>HTML/JavaScript/CSS</strong> с вкраплениями кода на <strong>Java</strong></p>
</li>
<li>
<p><strong>Enterprise JavaBeans (EJB)</strong> представляют классы, которые хранят бизнес-логику.</p>
</li>
<li>
<p><strong>Contexts and Dependency Injection (CDI)</strong> предоставляет механизм для внедрения и управления зависимостями в другие объекты.</p>
</li>
<li>
<p><strong>JSON Processing (JSON-P)</strong> позволяет работать со строками <strong>JSON</strong> в <strong>Java</strong></p>
</li>
<li>
<p><strong>JSON Binding (JSON-B)</strong> предоставляет функционал для сериализации и десериализации <strong>JSON</strong> в объекты <strong>Java</strong>.</p>
</li>
<li>
<p><strong>WebSocket</strong> позволяет интегрировать <strong>WebSocket</strong> в приложения на <strong>Java</strong>.</p>
</li>
<li>
<p><strong>Java Message Service (JMS)</strong> - <strong>API</strong> для пересылки сообщений между двумя и более клиентами.</p>
</li>
<li>
<p><strong>Security API</strong> - <strong>API</strong> для стандартизации и упрощения задач обеспечения безопасности в приложениях на <strong>Java</strong>.</p>
</li>
<li>
<p><strong>Java API for RESTful Web Services (JAX-RS)</strong> - <strong>API</strong> для применения архитектуры <strong>REST</strong> в приложениях.</p>
</li>
<li>
<p><strong>JavaServer Faces (JSF)</strong> предоставляет возможности для создания пользовательского интерфейса на стороне сервера.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Эти и ряд других <strong>API</strong> сообственно и образуют то, что называется <strong>Java EE</strong>. Стоит отметить, что также в среде веб-разработки на <strong>Java</strong> популярна еще одна технология <strong>Spring</strong>. Фреймворк <strong>Spring</strong> не является частью <strong>Java EE</strong> и может использоваться как альтернативный подход к созданию веб-приложений на языке <strong>Java</strong>.</p>
</div>
<div class="sect2">
<h3 id="_история_развития">1.1. История развития</h3>
<div class="paragraph">
<p>Предтечей <strong>Java EE</strong> был проект <strong>JPE Project</strong>, который стартовал в <strong>мае 1998 года</strong>. А в <strong>декабре 1999</strong> года вышел релиз платформы <strong>Enterprise Java Platform (J2EE 1.2)</strong>, которая объединяла такие компоненты как <strong>Servlet, JSP, EJB, JMS</strong>. В <strong>2006 году</strong> с выходом 5-й версии она была переименована в <strong>Java Enterprise Edition (JEE)</strong>. С тех пор периодически выходят новые версии платформы. Последняя текущая версия - <strong>Java EE 8</strong> вышла <strong>в сентябре 2017 года</strong>.</p>
</div>
<div class="paragraph">
<p><strong>В 2017 году</strong> произошла новая веха в развитии платформы: <strong>Oracle</strong> передал контроль над развитием <strong>Java EE</strong> организации <strong>Eclipse Foundation</strong>. А в апреле 2018 года <strong>Java EE</strong> была переименована в <strong>Jakarta EE</strong>.</p>
</div>
<div class="paragraph">
<p><strong>В начале 2019 года</strong> ожидается выход новой версии <strong>Jakarta/Java EE</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_установка_ide">1.2. Установка IDE</h3>
<div class="paragraph">
<p>Для работы с <strong>Java EE</strong> нам потребуется среда разработки или <strong>IDE</strong>. Есть различные среды разработки, которые ориентированы на корпоративную разрабоку под <strong>Java</strong>. Это <strong>IntelliJ IDEA</strong>, <strong>NetBeans</strong> и <strong>Eclipse</strong>. В данном случае на протяжении всего руководства мы преимущественно будем использовать <strong>Eclipse</strong>, потому что она является бесплатной и довольно широко распространена.</p>
</div>
<div class="paragraph">
<p>Для начала установим последнюю версию <strong>Eclipse</strong>, которую можно найти по адресу <a href="https://www.eclipse.org/downloads/">Eclipse</a>. На странице загрузок выберем найдем рядом с названием текущей версии <strong>Eclipse</strong> кнопку <em>Download</em> и нажмем на нее.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../assets/img/java/jakarta-ee/intro/eclipse-download.png" alt="Eclipse download"></span></p>
</div>
<div class="paragraph">
<p>После нажатия на кнопку нас перенаправит собственно на страницу загрузки, где необходимо будет нажать на кнопку <strong>"Download"</strong> для загрзуки установочного пакета:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../assets/img/java/jakarta-ee/intro/eclipse-download2.png" alt="Eclipse download"></span></p>
</div>
<div class="paragraph">
<p>После ее загрузки программы установки запустим ее и в отобразившемся списке опций выберем <strong>Eclipse IDE for Java EE Developers</strong>:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../assets/img/java/jakarta-ee/intro/eclipse-tools-javaee-download.png" alt="Eclipse tools Jakarta EE download"></span></p>
</div>
<div class="paragraph">
<p>Далее надо будет указать папку для установки (или оставить выбранную папку по умолчанию) и принять пару лицензионных соглашений, и среда будет установлена.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_apache_tomcat">2. Apache Tomcat</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_установка_tomcat">2.1. Установка Tomcat</h3>
<div class="paragraph">
<p><strong>Tomcat</strong> представляет <strong>веб-контейнер сервлетов</strong> и предназначен для работы с рядом технологий <strong>Java EE</strong>, в частности, с <strong>JSP</strong>, <strong>Servlet</strong> и рядом других. Нередко <strong>Tomcat</strong> называют <strong>веб-сервером</strong>.</p>
</div>
<div class="paragraph">
<p>В данном случае используется <strong>9-я версия</strong>. Для установки <strong>Tomcat</strong> перейдем на официальный сайт данного контейнера на страницу загрузок - <a href="https://tomcat.apache.org/download-90.cgi">Apache Tomcat</a>. На данной странице мы можем увидеть различные опции для загрузки:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>в виде архива, который достаточно распаковать</p>
</li>
<li>
<p>в виде инсталлятора.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/apache-tomcat/tomcat1.png" alt="Binary Distributions"></span></p>
</div>
<div class="paragraph">
<p>В данном случае большой разницы не будет, какой именно пакет использовать. Для упрощения настройки выберем пункт <strong>32-bit/64-bit Windows Service Installer</strong>.</p>
</div>
<div class="paragraph">
<p>После выбора этой опции на компьютер будет загружен инсталлятор, который надо запустить.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/apache-tomcat/tomcat2.png" alt="Installation window"></span></p>
</div>
<div class="paragraph">
<p>Вначале надо принять лицензионное соглашение:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/apache-tomcat/tomcat3.png" alt="Installation window"></span></p>
</div>
<div class="paragraph">
<p>Затем надо настроить устанавливаемые компоненты:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/apache-tomcat/tomcat4.png" alt="Installation window"></span></p>
</div>
<div class="paragraph">
<p>Здесь можно выбрать те компоненты, которые мы хотим установить, в частности, можно выбрать пункт <strong>Service Startup</strong>, и тогда <strong>Tomcat</strong> будет запускаться автоматически при запуске системы. Можно выбрать все, а можно ограничиться теми компонентами, которые уже выбраны по умолчанию.</p>
</div>
<div class="paragraph">
<p>Далее будет предложено настроить порты и ряд дополнительных моментов конфигурации <strong>Tomcat</strong>:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/apache-tomcat/tomcat5.png" alt="Installation window"></span></p>
</div>
<div class="paragraph">
<p>Здесь стоит обратить внимание на пункт <code>HTTP/1.1 Connector Port</code>. Он указывает, по какому порту будет запускаться приложение. Укажем в этом поле номер <code>8081</code>.</p>
</div>
<div class="paragraph">
<p>Затем надо будет указать версию <strong>Java</strong>, которая будет использоваться:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/apache-tomcat/tomcat6.png" alt="Installation window"></span></p>
</div>
<div class="paragraph">
<p>По умолчанию инсталлятор должен определять путь к <strong>Java</strong>. Но естественно при необходимости его можно изменить. И в конце надо будет указать путь к устанавливаемому веб-контейнеру на жестком диске:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/apache-tomcat/tomcat7.png" alt="Installation window"></span></p>
</div>
<div class="paragraph">
<p>Также можно оставить путь по умолчанию. И после этого собственно произойдет установка контейнера.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/apache-tomcat/tomcat8.png" alt="Installation window"></span></p>
</div>
<div class="paragraph">
<p>После установки на финальном экране оставим отмеченнным пункт <strong>Run Apache Tomcat</strong> и нажмем на кнопку <strong>Finish</strong>. После этого <strong>Tomcat</strong> будет запущен, и мы сможем к нему обращаться.</p>
</div>
<div class="paragraph">
<p>Убедимся, что <strong>Tomcat</strong> работает. Для этого обратимся в строке браузера по адресу <code><a href="http://localhost:8081" class="bare">http://localhost:8081</a></code>. В данном случае <code>8081</code> - это тот порт, который был указан на этапе установке выше. Если все <strong>Tomcat</strong> установлен и запущен правильно, то в браузере мы увидим некоторое стандартное содержимое:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/apache-tomcat/tomcat9.png" alt="Apache Tomcat welcom page"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_структура_apache_tomcat">2.2. Структура Apache Tomcat</h3>
<div class="paragraph">
<p>После установки в директории <strong>Apache Tomcat</strong> на жестком диске можно найти ряд файлов и директорий.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/apache-tomcat/tomcat-files-structure.png" alt="Tomcat files structure"></span></p>
</div>
<div class="paragraph">
<p>Основные каталоги:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>bin</code> хранит различные скрипты, в частности, для запуска, перезагрузки и т.д.</p>
</li>
<li>
<p><code>conf</code> хранит конфигурационные файлы, наиболее важным из которых является файл <code>server.xml</code>, который определяет основную часть конфигурации.</p>
</li>
<li>
<p><code>logs</code> директория по умолчанию для хранения лог-файлов.</p>
</li>
<li>
<p><code>webapps</code> директория, где хранятся собственно файлы приложений.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Таким образом, все файлы приложений будут помещаться в директорию <code>webapps</code>. По умолчанию после установки в ней можно найти ряд стандартных директорий:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/apache-tomcat/tomcat-webapps.png" alt="Tomcat Webapps"></span></p>
</div>
<div class="paragraph">
<p>Ключевая директория здесь - это директория <code>ROOT</code>. Так, все содержимое, которое мы видим в браузере по адресу <a href="http://localhost:8081" class="bare">http://localhost:8081</a>, как раз представляет файлы из этой директории.</p>
</div>
<div class="paragraph">
<p>Для примера создадим в директории <code>webapps</code> новую директорию <code>test</code>.</p>
</div>
<div class="paragraph">
<p>Далее создадим где-нибудь на жестком диске новый файл <code>hello.html</code> со следующим содержимым:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8" /&gt;
    &lt;title&gt;Tomcat&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h2&gt;Hello Apache Tomcat!!!&lt;/h2&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Этот обычный файл с кодом <strong>html</strong>. Затем скопируем этот файл в выше созданную директорию <code>test</code>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/apache-tomcat/tomcat-webapps-test.png" alt="Tomcat Webapps test"></span></p>
</div>
<div class="paragraph">
<p>После этого мы сможем обратиться к этому файлу в браузере по адресу <a href="http://localhost:8081/test/hello.html" class="bare">http://localhost:8081/test/hello.html</a>. То есть в начале указывается локальный адрес <code>localhost</code>, затем номер порта (в данном случае <code>8081</code>), далее название директории - <code>test</code>, и далее название файла - <code>hello.html</code>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/apache-tomcat/tomcat-webapps-page.png" alt="Tomcat Webapps page"></span></p>
</div>
<div class="paragraph">
<p>Стотит отметить, что при обращении к файлам в директории <code>ROOT</code>, нам не надо указывать название директории. Например, скопируем тот же файл <code>hello.html</code> в папку <code>ROOT</code>. Тогда к этому файлу мы можем обратиться по адресу <a href="http://localhost:8081/hello.html" class="bare">http://localhost:8081/hello.html</a></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/apache-tomcat/tomcat-hello-page.png" alt="Tomcat hello page"></span></p>
</div>
<div class="paragraph">
<p>Несмотря на то, что по умолчанию директория <code>ROOT</code> уже содержит некоторое содержимое справочного характера, тем не менее мы можем все это содержимое спокойно удалить и размещать в этой директории только файлы непосредственно нашего приложения. То есть мы вполне можем использовать директорию <code>ROOT</code>. Но как правило, приходится работать с несколькими приложениями, для которых лучше создавать отдельную директорию в директории <code>webapps</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jakarta_servlet">3. Jakarta Servlet</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_введение_в_сервлеты">3.1. Введение в сервлеты</h3>
<div class="paragraph">
<p>Сервлет представляет специальный тип классов Java, который выполняется на веб-сервере и который обрабатывает запросы и возвращает результат обработки.</p>
</div>
<div class="paragraph">
<p>Создадим первый сервлет. Определим где-нибудь на жестком диске файл <code>HelloServlet.java</code> со следующим кодом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.io.PrintWriter;
import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@WebServlet("/hello")
public class HelloServlet extends HttpServlet {
	protected void doGet(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException {
		response.setContentType("text/html");
		PrintWriter writer = response.getWriter();
		try {
			writer.println("&lt;h2&gt;Hello from HelloServlet&lt;/h2&gt;");
		} finally {
			writer.close();
		}
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Класс сервлета наследуется от класса <code>HttpServlet</code>. Перед определением класса указана аннотация <code>@WebServlet</code>, которая указывает, с какой конечной точкой будет сопоставляться данный сервлет. То есть данный сервлет будет обрабатывать запросы по адресу <code>/hello</code>.</p>
</div>
<div class="paragraph">
<p>Для обработки <strong>GET</strong>-запросов (например, при обращении к сервлету из адресной строки браузера) сервлет должен переопределить метод <code>doGet()</code>. То есть, к примеру, в данном случае get-запрос по адресу <code>/hello</code> будет обрабатываться методом <code>doGet()</code>.</p>
</div>
<div class="paragraph">
<p>Этот метод принимает два параметра. Параметр типа <code>HttpServletRequest</code> инкапсулирует всю информацию о запросе. А параметр типа <code>HttpServletResponse</code> позволяет управлять ответом. В частности, с помощью вызова <code>response.setContentType("text/html")</code> устанавливается тип ответа (в данном случае, мы говорим, что ответ представляет код html). А с помощью метода <code>getWriter()</code> объекта <code>HttpServletResponse</code> мы можем получить объект <code>PrintWriter</code>, через который можно отправить какой-то определенный ответ пользователю. В данном случае через метод <code>println()</code> пользователю отправляет простейший html-код. По завершению использования объекта <code>HttpServletResponse</code> его необходимо закрыть с помощью метода <code>close()</code>.</p>
</div>
<div class="paragraph">
<p>Для запуска сервлета воспользуемся опять же контейнером сервлетов <em>Apache Tomcat</em>. В каталоге <em>Tomcat</em> в папке <code>webapps</code> создадим каталог для нового приложения, который назовем <code>helloapp</code>.</p>
</div>
<div class="paragraph">
<p>В папке приложения классы сервлетов должны размещаться в папке <code>WEB-INF/classes</code>. Создадим в каталоге <code>helloapp</code> папку <code>WEB-INF</code>, а в ней папку <code>classes</code>. И в папку <code>helloapp/WEB-INF/classes</code> поместим файл <code>HelloServlet.java</code>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/servlet/servlet1.png" alt="servlet1"></span></p>
</div>
<div class="paragraph">
<p>Но нам нужен не код сервлета, а скомпилированный класс сервлета. Поэтому скомпилируем сервлет. Для этого нам нужно использовать специальную утилиту <code>servlet-api.jar</code>, которая находится в каталоге Tomcat в папке <code>lib</code>.</p>
</div>
<div class="paragraph">
<p>В начале в командной строке/терминале перейдем с помощью команды <code>cd</code> к папке <code>helloapp/WEB-INF/classes</code>, где расположен код сервлета.</p>
</div>
<div class="paragraph">
<p>Потом для компиляции сервлета выполним следующую команду:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="powershell">javac -cp .;"C:\Program Files\Apache Software Foundation\Tomcat 9.0\lib\servlet-api.jar" HelloServlet.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>В моем случае предполагается, что Tomcat размещен в каталоге <code>C:\Program Files\Apache Software Foundation\Tomcat 9.0</code>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/servlet/servlet2.png" alt="servlet2"></span></p>
</div>
<div class="paragraph">
<p>После этого в папке <code>helloapp/WEB-INF/classes</code> должен появиться класс сервлета. Перезапустим Tomcat и обратимся к нашему сервлету в браузере:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/servlet/servlet3.png" alt="servlet3"></span></p>
</div>
<div class="paragraph">
<p>Поскольку с помощью аннотации <code>@WebServlet</code> в классе сервлета была указана точка <code>/hello</code>, то при обращении к сервлету после домена и порта идет название приложения (<code>helloapp</code>) и конечная точка (<code>hello</code>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_как_работает_сервлет">3.2. Как работает сервлет</h3>
<div class="paragraph">
<p><strong>Сервлет</strong> - это класс, который расширяет функциональность класса <code>HttpServlet</code> и запускается внутри <strong>контейнера сервлетов</strong>.</p>
</div>
<div class="paragraph">
<p><strong>Сервлет</strong> размещается на сервере, однако чтобы сервер мог использовать сервлет для обработки запросов, сервер должен поддерживать движок или контейнер сервлетов (<strong>servlet container/engine</strong>). Например, <em>Apache Tomcat</em> по сути является контейнером сервлетов, поэтому он может использовать сервлеты для обслуживания запросов.</p>
</div>
<div class="paragraph">
<p>Для обработки запроса в <code>HttpServlet</code> определен ряд методов, которые мы можем переопределить в классе сервлета:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>doGet()</code> обрабатывает запросы <strong>GET</strong> (получение данных)</p>
</li>
<li>
<p><code>doPost()</code> обрабатывает запросы <strong>POST</strong> (отправка данных)</p>
</li>
<li>
<p><code>doPut()</code> обрабатывает запросы <strong>PUT</strong> (отправка данных для изменения)</p>
</li>
<li>
<p><code>doDelete()</code> обрабатывает запросы <strong>DELETE</strong> (удаление данных)</p>
</li>
<li>
<p><code>doHead()</code> обрабатывает запросы <strong>HEAD</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Каждый метод обрабатывает определенный тип запросов <strong>HTTP</strong>, и мы можем определить все эти методы, но, зачастую, работа идет в основном с методами <code>doGet()</code> и <code>doPost()</code>. Например, определение методов без реализации:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@WebServlet("/hello")
public class HelloServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
        throws ServletException, IOException {
    }

    protected void doPost(HttpServletRequest request, HttpServletResponse response)
        throws ServletException, IOException {
    }

    protected void doPut(HttpServletRequest request, HttpServletResponse response)
        throws ServletException, IOException {
    }

    protected void doDelete(HttpServletRequest request, HttpServletResponse response)
        throws ServletException, IOException {
    }

    protected void doHead(HttpServletRequest request, HttpServletResponse response)
        throws ServletException, IOException {
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Все методы в качестве параметра принимают два объекта:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>HttpServletRequest</code> хранит информацию о запросе</p>
</li>
<li>
<p><code>HttpServletResponse</code> управляет ответом на запрос.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_жизненный_цикл_сервлета">3.2.1. Жизненный цикл сервлета</h4>
<div class="paragraph">
<p>Для каждого сервлета движок сервлетов создает только одну копию. Вне зависимости от того, сколько запросов будет отправлено сервлету, все запросы будут обрабатываться толькой одной копией сервлета. Объект сервлета создается либо при запуске движка сервлетов, либо когда сервлет получает первый запрос. Затем для каждого запроса запускается поток, который обращается к объекту сервлета.</p>
</div>
<div class="paragraph">
<p>При работе с сервлетом движок сервлетов вызывает у класса сервлета ряд методов, которые определены в родительском абстрактном классе <code>HttpServlet</code>.</p>
</div>
<div class="paragraph">
<p>Когда движок сервлетов создает объект сервлета, у сервлета вызывается метод <code>init()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public void init(ServletConfig config) throws ServletException {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Этот метод вызывается только один раз - при создании сервлета. Мы можем переопределить этот метод, чтобы определить в нем некоторую логику инициализации.</p>
</div>
<div class="paragraph">
<p>Когда к сервлету приходит запрос, движок сервлетов вызывает метод <code>service()</code> сервлета. А этот метод, исходя из типа запроса (<strong>GET</strong>, <strong>POST</strong>, <strong>PUT</strong> и т.д.) решает, какому методу сервлета (<code>doGet()</code>, <code>doPost()</code> и т.д.) обрабатывать этот запрос.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public void service(HttpServletRequest request, HttpServletResponse response)
		throws IOException, ServletException {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Этот метод также можно переопределить, однако в этом нет смысла. В реальности для обработки запроса переопределяются методы <code>onGet()</code>, <code>onPost()</code> и т.д., которые обрабатывают конкретные типы запросов.</p>
</div>
<div class="paragraph">
<p>Если объект сервлета долгое время не используется (к нему нет никаких запросов), или если происходит завершение работы движка сервлетов, то движок сервлетов выгружает из памяти все созданные экземпляры сервлетов. Однако до выгрузки сервлета из памяти у сервлета вызывается метод <code>destroy()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public void destroy() {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>При необходимости мы также можем его переопределить, например, определить в нем логику логгирования или что иное. В то же время следует учитывать, что если сервер вдруг упадет по какой-то причине, например, отключится электричество и т.д., тогда данный метод естественно не будет вызван и его логика не сработает.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/servlet/lifecycle.png" alt="Lifecycle"></span></p>
</div>
<div class="paragraph">
<p>Поскольку для обработки всех запросов создается один экземпляр сервлета, и все обращения к нему идут в отдельных потоках, то не рекомендуется в классе сервлета объявлять и использовать глобальные переменные, так как они не будут потокобезопасными.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_получение_данных_в_сервлете">3.3. Получение данных в сервлете</h3>
<div class="paragraph">
<p>В методы <code>doGet()</code> и <code>doPost()</code> сервлета, которые обрабатывают запрос, в качестве одного из параметров передается объект <code>HttpServletRequest</code>, с помощью которого можно получить отправленные сервлету данные, то есть параметры запроса. Для этого в классе <code>HttpServletRequest</code> определены два метода:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getParameter(String param)</code> возвращает значение определенного параметра, название которого передается в метод. Если указанного параметра в запросе нет, то возвращается значение <code>null</code>.</p>
</li>
<li>
<p><code>getParameterValues(String param)</code> возвращает массив значений, который представляет определенный параметр. Если указанного параметра в запросе нет, то возвращается значение <code>null</code>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_получение_данных_из_строки_запроса">3.3.1. Получение данных из строки запроса</h4>
<div class="paragraph">
<p>Передавать значения в сервлет можно различными способами. При отправке <strong>GET</strong>-запроса значения передаются через строку запроса. Стандартный get-запрос принимает примерно следующую форму: <code>название_ресурса?параметр1=значение1&amp;параметр2=значение2</code>.</p>
</div>
<div class="paragraph">
<p>Например, определим следующий сервлет:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.io.PrintWriter;
import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@WebServlet("/hello")
public class HelloServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        response.setContentType("text/html");
        PrintWriter writer = response.getWriter();
        // получаем параметр id
        String id = request.getParameter("id");
        try {
            writer.println("&lt;h2&gt;Id:" + id + "&lt;/h2&gt;");
        } finally {
            writer.close();
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>В данном случае мы предполагаем, что в сервлет в <strong>get</strong>-запросе передается значение/параметр по имени <code>id</code>. С помощью вызова <code>request.getParameter("id")</code> мы получаем значение этого параметра и затем отправляем его в ответ пользователю. При этом стоит учитывать, что неважно, что мы будем передавать извне - целое или дробное число, отдельный символ, в любом случае метод <code>getParameter()</code> возвратить строку.</p>
</div>
<div class="paragraph">
<p>Запустим приложение и обратимся к сервлету:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/servlet/servlet7.jpg" alt="serlvet7"></span></p>
</div>
<div class="paragraph">
<p>В случае выше значение для параметра <code>id</code> не указано, мы просто вводим в адресной строке браузера название ресурса - в данном случае <code><a href="http://localhost:8081/helloapp/hello" class="bare">http://localhost:8081/helloapp/hello</a></code>, где <code>helloapp</code> - название приложения, а <code>hello</code> - конечная точка, к которой примонтирован сервлет. Поэтому метод <code>getParameter("id"</code>) возвращает значение <code>null</code>.</p>
</div>
<div class="paragraph">
<p>Теперь передадим значение для параметра <code>id</code>:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/servlet/servlet8.jpg" alt="servlet8"></span></p>
</div>
<div class="paragraph">
<p>Параметры в строке запроса указываютя после названия ресурса после знака вопроса:` <a href="http://localhost:8081/helloapp/hello?id=5`.В" class="bare">http://localhost:8081/helloapp/hello?id=5`.В</a> данном случае параметр <code>id</code> равен <code>5</code>.</p>
</div>
<div class="paragraph">
<p>Подобным образом можно передавать несколько параметров. Например, изменим сервлет следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.io.PrintWriter;
import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@WebServlet("/hello")
public class HelloServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        response.setContentType("text/html");
        PrintWriter writer = response.getWriter();
        String name = request.getParameter("name");
        String age = request.getParameter("age");

        try {
            writer.println("&lt;h2&gt;Name: " + name + "; Age: " + age + "&lt;/h2&gt;");
        } finally {
            writer.close();
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>В данном случае сервлет получает два параметра: <code>name</code> и <code>age</code>. Мы можем передать значения для них, набрав в адресной строке, например,` <a href="http://localhost:8081/helloapp/hello?name=Tom&amp;age=34.`" class="bare">http://localhost:8081/helloapp/hello?name=Tom&amp;age=34.`</a> При передаче некольких параметров они отделяются друг от друга знаком амперсанда <code>&amp;</code>. Подобным образом мы можем передать и большее количество параметров.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/servlet/servlet9.jpg" alt="servlet9"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_передача_массивов">3.3.2. Передача массивов</h4>
<div class="paragraph">
<p>В примерах выше передавались одиночные данные - отдельные строки. Но также мы можем передавать наборы значений. Например, изменим сервлет следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.io.PrintWriter;
import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@WebServlet("/hello")
public class HelloServlet extends HttpServlet {

    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        response.setContentType("text/html");
        PrintWriter writer = response.getWriter();
        String[] nums = request.getParameterValues("nums");

        try {
            writer.print("&lt;h2&gt;Numbers: ");
            for(String n: nums)
                writer.print(n + " ");
            writer.println("&lt;/h2&gt;");
        } finally {
            writer.close();
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Если в сервлет передается массив значений, то для его получения у объекта <code>HttpServletRequest</code> применяется метод <code>getParameterValues()</code>, который получает название параметра и возвращает массив строк. В данном случае мы ожидаем, что параметр будет называться <code>nums</code>. Затем значения из этого параметра в цикле передаются в ответ клиенту.</p>
</div>
<div class="paragraph">
<p>Запустим сервлет и передадим ему значения</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/servlet/servlet10.jpg" alt="servlet10"></span></p>
</div>
<div class="paragraph">
<p>При передаче массива через строку запроса указываются несколько значений с одним и тем же именем: <code><a href="http://localhost:8081/helloapp/hello?nums=1&amp;nums=2&amp;nums=3" class="bare">http://localhost:8081/helloapp/hello?nums=1&amp;nums=2&amp;nums=3</a></code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_получение_данных_из_форм">3.3.3. Получение данных из форм</h4>
<div class="paragraph">
<p>Еще одним распространенным способом отправки данных является отправка форм. Добавим в проект страницу <code>index.html</code> со следующим кодом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;User Form&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form action="hello" method="POST"&gt;
        Name: &lt;input name="username" /&gt;
        &lt;br&gt;&lt;br&gt;
        Age: &lt;input name="userage" /&gt;
        &lt;br&gt;&lt;br&gt;
        Gender: &lt;input type="radio" name="gender" value="female" checked /&gt;Female
        &lt;input type="radio" name="gender" value="male" /&gt;Male
        &lt;br&gt;&lt;br&gt;
        Country: &lt;select name="country"&gt;
            &lt;option&gt;Canada&lt;/option&gt;
            &lt;option&gt;Spain&lt;/option&gt;
            &lt;option&gt;France&lt;/option&gt;
            &lt;option&gt;Germany&lt;/option&gt;
        &lt;/select&gt;
        &lt;br&gt;&lt;br&gt;
        Courses:
        &lt;input type="checkbox" name="courses" value="JavaSE" checked /&gt;Java SE
        &lt;input type="checkbox" name="courses" value="JavaFX" checked /&gt;Java FX
        &lt;input type="checkbox" name="courses" value="JavaEE" checked /&gt;Java EE
        &lt;br&gt;&lt;br&gt;
        &lt;input type="submit" value="Submit" /&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Как правило, формы отправлются с помощью запроса <strong>POST</strong>, поэтому у элемента формы определен атрибут <code>method="POST"</code>. Сама форма будет отправляться на ресурс <code>/hello</code>, с которым будет сопоставляться сервлет. На самой форме есть множество полей ввода, в том числе набор чекбоксов, из которых можно выбрать сразу несколько значений.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/servlet/servlet11.jpg" alt="servlet11"></span></p>
</div>
<div class="paragraph">
<p>Теперь определим сервлет, который будет обрабатывать эту форму:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.io.PrintWriter;
import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@WebServlet("/hello")
public class HelloServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        response.setContentType("text/html");
        PrintWriter writer = response.getWriter();

        String name = request.getParameter("username");
        String age = request.getParameter("userage");
        String gender = request.getParameter("gender");
        String country = request.getParameter("country");
        String[] courses = request.getParameterValues("courses");

        try {
            writer.println("&lt;p&gt;Name: " + name + "&lt;/p&gt;");
            writer.println("&lt;p&gt;Age: " + age + "&lt;/p&gt;");
            writer.println("&lt;p&gt;Gender: " + gender + "&lt;/p&gt;");
            writer.println("&lt;p&gt;Country: " + country + "&lt;/p&gt;");
            writer.println("&lt;h4&gt;Courses&lt;/h4&gt;");
            for (String course: courses) {
                writer.println("&lt;li&gt;" + course + "&lt;/li&gt;");
            }
        } finally {
            writer.close();
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Данный сервлет будет обрабатывать запросы к по адресу <code>/hello</code>, на который отпавляется форма. Поскольку отправка формы осущетвляется с помощью метода <code>POST</code>, то для обработки запроса определен метод <code>doPost()</code>. Метод <code>doPost()</code> принимает те же параметры, что и метод <code>doGet()</code>.</p>
</div>
<div class="paragraph">
<p>С помощью методов <code>getParameter()</code> и <code>getParameterValues()</code> также получаем значения параметров. В данном случае названия параметров представляют названия полей ввода отправленной формы.</p>
</div>
<div class="paragraph">
<p>Причем поскольку на форме несколько чекбоксов, которые имеют одно и то же имя, то соответственно сервлету передается набор значений, который получаем с помощью метода <code>getParameterValues()</code>. Все остальные поля представляют одиночные значения, поэтому для получения их данных применяется метод <code>getParameter()</code>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/servlet/servlet12.jpg" alt="servlet12"></span></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_переадресация_и_перенаправление_запроса">3.4. Переадресация и перенаправление запроса</h3>
<div class="paragraph">
<p>Одной из распространеных задач веб-программирования является переадресация. Рассмотрим, как мы можем в сервлетах выполнять переадресацию на другой ресурс.</p>
</div>
<div class="sect3">
<h4 id="_перенаправление_запроса">3.4.1. Перенаправление запроса</h4>
<div class="paragraph">
<p>Метод <code>forward()</code> класса <code>RequestDispatcher</code> позволяет перенаправить запрос из сервлета на другой сервлет, <code>html-страницу</code> или страницу <code>jsp</code>. Причем в данном случае речь идет о перенаправлении запроса, а не о переадресации.</p>
</div>
<div class="paragraph">
<p>Например, пусть в проекте определена страница <code>index.html</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Servlets in Java&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h2&gt;Index.html&lt;/h2&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Данная страница просто выводит заголовок.</p>
</div>
<div class="paragraph">
<p>И, допустим, мы хотим из сервлета перенаправить запрос на эту страницу:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.io.IOException;
import javax.servlet.RequestDispatcher;
import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@WebServlet("/hello")
public class HelloServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        String path = "/index.html";
        ServletContext servletContext = getServletContext();
        RequestDispatcher requestDispatcher = servletContext.getRequestDispatcher(path);
        requestDispatcher.forward(request, response);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Для того, чтобы выполнить перенаправление запроса, вначале с помощью метода <code>getServletContext()</code> получаем объект <code>ServletContext</code> , который представляет контекст запроса. Затем с помощью его метода <code>getRequestDispatcher()</code> получаем объект <code>RequestDispatcher</code> . Путь к ресурсу, на который надо выполнить перенаправление, передается в качестве параметра в <code>getRequestDispatcher()</code> .</p>
</div>
<div class="paragraph">
<p>Затем у объекта RequestDispatcher вызывается метод <code>forward()</code>, в который передаются объекты <code>HttpServletRequest</code> и <code>HttpServletResponse</code> .</p>
</div>
<div class="paragraph">
<p>И если мы обратимся к сервлету, то фактически мы получим содержимое страницы <code>index.html</code> , который будет перенаправлен запрос.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/servlet/jsp-hello.jpg" alt="JSP-hello"></span></p>
</div>
<div class="paragraph">
<p>Подобным образом мы можем выполнять перенаправление на страницы <code>jsp</code> и другие сервлеты. Например, добавим в проект новый сервлет <code>NotFoundServlet</code> :</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/servlet/not-found-servlet.jpg" alt="NotFoundServlet"></span></p>
</div>
<div class="paragraph">
<p>Определим для <code>NotFoundServlet</code> следующий код:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.io.IOException;
import java.io.PrintWriter;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@WebServlet("/notfound")
public class NotFoundServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        response.setContentType("text/html");
        PrintWriter writer = response.getWriter();
        String id = request.getParameter("id");
        try {
            writer.println("&lt;h2&gt;Not Found: " + id + "&lt;/h2&gt;");
        } finally {
            writer.close();
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>В данном случае <code>NotFoundServlet</code> сопоставляется с адресом <code>/notfound</code>.</p>
</div>
<div class="paragraph">
<p>Изменим код <code>HelloServlet</code> , чтобы он перенаправлял на NotFoundServlet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@WebServlet("/hello")
public class HelloServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
throws ServletException, IOException {

        String path = "/notfound";
            ServletContext servletContext = getServletContext();
            RequestDispatcher requestDispatcher = servletContext.getRequestDispatcher(path);
            requestDispatcher.forward(request, response);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>В данном случае если <code>id</code> равен <code>null</code> , то идет перенаправление на <code>NotFoundServlet</code>. Следует отметить, что в метод requestDispatcher.forward передаются объекты <code>HttpServletRequest</code> и <code>HttpServletResponse</code>. То есть <code>NotFoundServlet</code> получит те же самые данные запроса, что и <code>HelloServlet</code>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/servlet/jsp-not-found.jpg" alt="Not Found JSP-pages"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_переадресация">3.4.2. Переадресация</h4>
<div class="paragraph">
<p>Для переадресации применяется метод <code>sendRedirect()</code> объекта <code>HttpServletResponse</code>. В качестве параметра данный метод принимает адрес переадресации. Адрес может быть локальным, внутренним, а может быть и внешним.</p>
</div>
<div class="paragraph">
<p>Например, если сервлету <code>HelloServlet</code> не передано значение для параметра <code>id</code>, выполним переадресацию на сервлет <code>NotFoundServlet</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@WebServlet("/hello")
public class HelloServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
throws ServletException, IOException {
        String id = request.getParameter("id");
        if (id == null) {
            String path = request.getContextPath() + "/notfound";
            response.sendRedirect(path);
        } else {
            response.setContentType("text/html");
            PrintWriter writer = response.getWriter();
            try {
                writer.println("&lt;h2&gt;Hello Id " + id + "&lt;/h2&gt;");
            } finally {
                writer.close();
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>В данном случае переадресация идет на локальный ресурс. Но важно понимать, что в метод <code>sendRedirect</code> передается адрес относительно корня текущего домена. То есть в данном случае у нас домен и порт <code><a href="http://localhost:8001/" class="bare">http://localhost:8001/</a></code>, а приложение называется <code>helloapp</code>, то для обращения к сервлету <code>NotFoundServlet</code> необходимо передать адрес <code>helloapp/notfound</code>. Путь к текущему приложению можно получить с помощью метода <code>getContextPath()</code>.</p>
</div>
<div class="paragraph">
<p>Также можно выполнять и переадресацию на внешний ресурс, указывая полный адрес:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">response.sendRedirect("https://metanit.com/");</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_web_xml_и_маппинг_сервлетов">3.5. <code>web.xml</code> и маппинг сервлетов</h3>
<div class="paragraph">
<p>При определении сервлетов применялась аннотация <code>@WebServlet</code>, которая устанавливала конечную точку, с которой сопоставлялся сервлет. Например:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@WebServlet("/hello")
public class HelloServlet extends HttpServlet {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вышеприведенный сервлет сопоставляется с путем <code>"/hello"</code>. То есть сервлет <code>HelloServlet</code> будет обрабатывать запросы типа <code>"<a href="http://localhost:8081/">название_приложения</a>/hello"</code> или <code>"<a href="http://somesite.com/">название_приложения</a>/hello"</code>.</p>
</div>
<div class="paragraph">
<p>Но есть и другой способ сопоставления путей и сервлетов. Он представляет использование файла <code>web.xml</code>.</p>
</div>
<div class="paragraph">
<p>Файл <code>web.xml</code> хранит информацию о конфигурации приложения. Он не является обязательной частью приложения, тем не менее он широко используется для настройки конфигурации.</p>
</div>
<div class="paragraph">
<p>Данный файл должен располагаться в папке <code>WEB-INF</code> приложения. При запуске <strong>Tomcat</strong> считывает его содержимое и использует считанную конфигурацию. Если же файл содержит ошибки, то <strong>Tomcat</strong> отображает ошибку.</p>
</div>
<div class="paragraph">
<p><code>web.xml</code> имеет определенную структуру. Все вложенные узлы, которые определяют конфигурацию, помещаются в корневой узел <code>&lt;web-app&gt;</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
                        http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
    version="4.0"&gt;
&lt;/web-app&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>У элемента <code>web-app</code> определяется ряд атрибутов. В данном случае атрибуты <code>xmlns</code> и <code>xmlns:xsi</code> указывают на используемые пространства имен <code>xml</code>. Атрибут <code>version</code> указывает на версию спецификации сервлетов или <code>Servlet API</code>, которая используется в приложении. Последняя версия <code>API</code> сервлетов - 4.0.</p>
</div>
<div class="paragraph">
<p>С помощью элемента <code>&lt;servlet-mapping&gt;</code> можно задать сопоставление сервлета с запрашиваемым <strong>URL</strong>.</p>
</div>
<div class="paragraph">
<p>Например, добавим в проект в <strong>Eclipse</strong> в директорию <code>WebConent/WEB-INF</code> новый файл <code>web.xml</code>:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/servlet/config-servlets.jpg" alt="web.xml"></span></p>
</div>
<div class="paragraph">
<p>Определим в нем следующий код:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
                        http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
    version="4.0"&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;HelloWorld&lt;/servlet-name&gt;
        &lt;servlet-class&gt;HelloServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;HelloWorld&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/welcome&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

&lt;/web-app&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Прежде всего вначале с помощью элемента <code>&lt;servlet&gt;</code> определяется сервлет. Элемент <code>&lt;servlet-name&gt;</code> задает имя сервлета, на которое будет проецировать класс, указанный в элементе <code>&lt;servlet-class&gt;</code>. То есть, допустим, у нас проекте есть класс сервлета <code>HelloServlet</code>, который будет проецироваться на имя <code>HelloWorld</code>. Имя может быть произвольным и может совпадать с названием класса.</p>
</div>
<div class="paragraph">
<p>Затем в элементе <code>&lt;servlet-mapping&gt;</code> сервлет с именем <code>HelloWorld</code> (по сути сервлет <code>HelloServlet</code>) сопоставляется с путем <code>/welcome</code>.</p>
</div>
<div class="paragraph">
<p>Допустим, сервлет <code>HelloServlet</code> будет выглядеть следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.io.IOException;
import java.io.PrintWriter;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class HelloServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        response.setContentType("text/html");
        PrintWriter writer = response.getWriter();
        try {
            writer.println("&lt;h2&gt;Welcome to servlets&lt;/h2&gt;");
        } finally {
            writer.close();
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Теперь, чтобы обратиться к этому сервлету, надо использовать путь <code>/welcome</code>:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/servlet/request-welcome.jpg" alt="Request welcom"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_параметры_инициализации_сервлетов">3.6. Параметры инициализации сервлетов</h3>
<div class="sect3">
<h4 id="_общие_параметры">3.6.1. Общие параметры</h4>
<div class="paragraph">
<p>Элемент <code>&lt;context-param&gt;</code> в файле <code>web.xml</code> задает параметр, которым инициализируются сервлеты. Внутри этого элемента с помощью элемента <code>&lt;param-name&gt;</code> задается имя параметра, а с помощью элемента <code>&lt;param-value&gt;</code> - значение параметра.</p>
</div>
<div class="paragraph">
<p>Например, определим следующий файл <code>web.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
                        http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
    version="4.0"&gt;

    &lt;context-param&gt;
        &lt;param-name&gt;message&lt;/param-name&gt;
        &lt;param-value&gt;Hello Servlets&lt;/param-value&gt;
    &lt;/context-param&gt;

&lt;/web-app&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>В данном случае параметр называется <code>message</code> и имеет значение <code>Hello Servlets</code>. Этот параметр доступен всем сервлетам в приложении.</p>
</div>
<div class="paragraph">
<p>Для получения параметра внутри сервлета необходимо обратиться к контексту сервлета. Для его получения внутри класса сервлета определен метод <code>getServletContext()</code>. Он возвращает объект <code>ServletContext</code>. Затем у этого объекта вызывается метод <code>getInitParameter()</code>, в который передается название параметра инициализации.</p>
</div>
<div class="paragraph">
<p>Например, получим выше определенный параметр в сервлете:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@WebServlet("/hello")
public class HelloServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        String message = getServletContext().getInitParameter("message");
        response.setContentType("text/html");
        PrintWriter writer = response.getWriter();
        try {
            writer.println("&lt;h2&gt;" + message + "&lt;/h2&gt;");
        } finally {
            writer.close();
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/servlet/hello-page.jpg" alt="Hello page"></span></p>
</div>
<div class="paragraph">
<p>Стоит отметить, что этот параметр будет доступен для всех сервлетов в приложении. Соответственно если мы изменим в <code>web.xml</code> значение параметра, то оно изменится для всех сервлетов.</p>
</div>
</div>
<div class="sect3">
<h4 id="_параметры_для_отдельного_сервлета">3.6.2. Параметры для отдельного сервлета</h4>
<div class="paragraph">
<p>Кроме определения общих для всех сервлетов параметров, мы можем определить параметры непосредственно для конкретного сервлета. Для этого внутри элемента <code>&lt;servlet&gt;</code> определяется элемент <code>&lt;init-param&gt;</code></p>
</div>
<div class="paragraph">
<p>Например, изменим <code>web.xml</code> следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
                        http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
    version="4.0"&gt;
    &lt;servlet&gt;
        &lt;servlet-name&gt;HelloServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;HelloServlet&lt;/servlet-class&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;message&lt;/param-name&gt;
            &lt;param-value&gt;Hello Servlets&lt;/param-value&gt;
        &lt;/init-param&gt;
    &lt;/servlet&gt;
&lt;/web-app&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Здесь также задан параметр <code>message</code> со значением <code>Hello Servlets</code>. Чтобы получить этот параметр в классе сервлете, необходимо использовать метод <code>getServletConfig()</code>, который возвращает объект <code>ServletConfig</code>. У него затем вызывается метод <code>getInitParameter()</code>, в который передается имя параметра. Например:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@WebServlet("/hello")
public class HelloServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        String message = getServletConfig().getInitParameter("message");
        response.setContentType("text/html");
        PrintWriter writer = response.getWriter();
        try {
            writer.println("&lt;h2&gt;" + message + "&lt;/h2&gt;");
        } finally {
            writer.close();
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_обработка_ошибок">3.7. Обработка ошибок</h3>
<div class="paragraph">
<p>Файл <code>web.xml</code> позволяет указать, какие страницы <strong>html</strong> или <strong>jsp</strong> будут отправляться пользователю при отправке статусных кодов ошибок. Для этого в <code>web.xml</code> применяется элемент <code>&lt;error-page&gt;</code>.</p>
</div>
<div class="paragraph">
<p>Внутри этого элемента с помощью элемента <code>&lt;error-code&gt;</code> указывается статусный код ошибки, который надо обработать. А элемент <code>&lt;location&gt;</code> указывает на путь к странице <strong>html</strong> или <strong>jsp</strong>, которая будет отправляться пользователю.</p>
</div>
<div class="paragraph">
<p>Например, добавим в проект в папку <code>WebContent</code> новый файл <code>404.html</code> со следующим кодом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Not Found&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h2&gt;Resource not found!&lt;/h2&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/servlet/page-404.jpg" alt="Page 404"></span></p>
</div>
<div class="paragraph">
<p>В файле <code>web.xml</code> определим следующее содержимое:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
                        http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
    version="4.0"&gt;
    &lt;error-page&gt;
        &lt;error-code&gt;404&lt;/error-code&gt;
        &lt;location&gt;/404.html&lt;/location&gt;
    &lt;/error-page&gt;
&lt;/web-app&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>В данном случае элемент <code>error-code</code> указывает, что мы будем обрабатывать ошибки со статусным кодом <code>404</code> (то есть такие ошибки, которые подразумевают отсутствие ресурса на сервере). А элемент <code>location</code> указывает, что в случае обращения к несуществующему ресурсу пользователю будет отправляться страница <code>404.html</code>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/servlet/page-not-found.jpg" alt="Page Not Found"></span></p>
</div>
<div class="sect3">
<h4 id="_обработка_исключений">3.7.1. Обработка исключений</h4>
<div class="paragraph">
<p>Кроме настройки обработки стандартных ошибок протокола <strong>http</strong>, типа <strong>404</strong> или <strong>403</strong>, файл <code>web.xml</code> позволяет настроить обработку исключений, которые могут возникнуть при обработке запроса. Для этого в <code>web.xml</code> применяется элемент <code>&lt;exception-type&gt;</code>.</p>
</div>
<div class="paragraph">
<p>Например, добавим в проект в папку <code>WebContent</code> новый файл <code>error.jsp</code> и определим в нем следующий код:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;%
   String message = pageContext.getException().getMessage();
   String exception = pageContext.getException().getClass().toString();
%&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Exception&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h2&gt;Exception occurred while processing the request&lt;/h2&gt;
    &lt;p&gt;Type: &lt;%= exception%&gt;&lt;/p&gt;
    &lt;p&gt;Message: &lt;%= message %&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Данная страница <strong>jsp</strong> будет отображать информацию об исключении. Через глобальный объект <code>pageContext</code> в страницу передается контекст. Если при обработке запроса возникло какое-нибудь исключение, то метод <code>pageContext.getException()</code> возвратит это исключение в виде объекта <code>Exception</code>. И далее мы можем исследовать этот объект и вызывать его методы, например, получить тип исключения и сообщение об исключении.</p>
</div>
<div class="paragraph">
<p>Симитируем с сервлете какое-нибудь исключение:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@WebServlet("/hello")
public class HelloServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        int x = 0;
        int y = 8 / x;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>В данном случае мы получаем ошибку деления на нуль, которая представлена типом <code>java.lang.ArithmeticException</code>.</p>
</div>
<div class="paragraph">
<p>Теперь определим следующий файл <code>web.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
                        http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
    version="4.0"&gt;
    &lt;error-page&gt;
        &lt;exception-type&gt;java.lang.Throwable&lt;/exception-type&gt;
        &lt;location&gt;/error.jsp&lt;/location&gt;
    &lt;/error-page&gt;
&lt;/web-app&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Элемент <code>exception-type</code> указывает, что обрабатываться будут исключения типа <code>java.lang.Throwable</code>. Поскольку это базовый класс для всех типов исключений, то фактически мы будем обрабатывать все исключения. Хотя можно конкретизировать тип исключения, например, указать тот же <code>java.lang.ArithmeticException</code>.</p>
</div>
<div class="paragraph">
<p>Элемент <code>location</code> определяет страницу, которая отправляется пользователю при возникновении исключении. В данном случае это <code>error.jsp</code>.</p>
</div>
<div class="paragraph">
<p>В итоге при обращении к сервлету будет сгенерировано исключение, и мы увидим информацию о нем:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/servlet/page-exception.jpg" alt="Page exception"></span></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cookies">3.8. Cookies</h3>
<div class="paragraph">
<p><strong>Куки</strong> представляют простейший способ хранения данных приложения. <strong>Куки</strong> хранятся в браузере польвователя в виде пары ключ-значение: с каждым уникальным ключом сопоставлется определенное значение. По ключу мы можем получить сохраненное в куках значение. Приложение на сервере может устанавливать куки и отправлять в ответе пользователю, после чего куки сохраняются в браузере. Когда клиент отправляет запроск приложению, то в запросе также отправляются и те куки, которые установлены данным приложением.</p>
</div>
<div class="paragraph">
<p><strong>Куки</strong> могут быть двух типов:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>сеансовые куки, т.е. когда пользователь закрывает вкладку браузера и прекращает работать с приложением, то куки сеанса уничтожаются.</p>
</li>
<li>
<p>постоянные куки - хранятся в течение продолжительного времени (до <code>3</code> лет).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Следует учитывать некоторые ограничения. Прежде всего куки нередко ограничены по размеру (обычно не более <strong>4 килобайт</strong>). Кроме того, обычно браузеры принимают не более <strong>20</strong> кук с одного сайта. Более того, в некоторых браузерах может быть отключена поддержка кук.</p>
</div>
<div class="paragraph">
<p>Для работы с куками сервлеты могут используют класс <code>javax.servlet.http.Cookie</code>. Для создания куки надо создать объект этого класса с помощью констуктора <code>Cookie(String name, String value)</code>, где <code>name</code> - ключ, а <code>value</code> - значение, которое сохраняется в куках. Стоит отметить, что мы можем сохранить в куках только строки.</p>
</div>
<div class="paragraph">
<p>Чтобы добавить куки в ответ клиенту у объекта <code>HttpServletResponse</code> применяется метод <code>addCookie(Cookie c)</code>.</p>
</div>
<div class="paragraph">
<p>При создании куки мы можем использовать ряд методов объекта <code>Cookie</code> для установки и получения отдельных параметров:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>setMaxAge(int maxAgeInSeconds)</code> устанавливает время в секундах, в течение которого будут существовать куки. Специальное значение <code>-1</code> указывает, что куки будут существовать только в течение сессии и после закрытия браузера будут удалены.</p>
</li>
<li>
<p><code>setValue(String value)</code> устанавливает хранимое значение.</p>
</li>
<li>
<p><code>getMaxAge()</code> возвращает время хранения кук.</p>
</li>
<li>
<p><code>getName()</code> возвращает ключ кук.</p>
</li>
<li>
<p><code>getValue()</code> возвращает значение кук.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Например, установка куки с названием <code>user</code> и значением <code>Tom</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">Cookie cookie = new Cookie("user", "Tom");
response.addCookie(cookie);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Чтобы получить куки, которые приходят в запросе от клиента, применяется метод <code>getCookies()</code> класса <code>HttpServletRequest</code>.</p>
</div>
<div class="paragraph">
<p>Например, получение куки по имени:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">Cookie[] cookies = request.getCookies();
String cookieName = "user";
Cookie cookie = null;
if(cookies != null) {
    for(Cookie c: cookies) {
        if(cookieName.equals(c.getName())) {
            cookie = c;
            break;
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Получение куки по имени немного громоздко, поскольку нам надо перебрать набор полученных кук и сравнить их с нужным ключом. Поэтому при частном использовании, как правило, определяют вспомогаельные методы, которые инкапсулируют подобную функционалность.</p>
</div>
<div class="paragraph">
<p>Например, определим сервлет <code>SetServlet</code>, который будет устанавливать куки:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.Cookie;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@WebServlet("/set")
public class SetServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        PrintWriter out = response.getWriter();
        try {
            response.addCookie(new Cookie("user", "Tom"));
            out.println("Cookie is set");
        }
        finally {
            out.close();
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>В данном случае устанавливается куки <code>user</code>, которая хранит строку <code>Tom</code>.</p>
</div>
<div class="paragraph">
<p>Определим сервлет <code>HelloServlet</code>, который получает эту куку:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.Cookie;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@WebServlet("/hello")
public class HelloServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        Cookie[] cookies = request.getCookies();
        String cookieName = "user";
        Cookie cookie = null;
        if(cookies != null) {
            for(Cookie c: cookies) {
                if(cookieName.equals(c.getName())) {
                    cookie = c;
                    break;
                }
            }
        }
        PrintWriter out = response.getWriter();
        try {
            out.println("Name: " + cookie.getValue());
        }
        finally {
            out.close();
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Таким образом, при обращении к сервлету <code>SetServlet</code> произойдет установка кук, а при обращении к сервлету <code>HelloServlet</code> мы получим установленные куки:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/servlet/cookies.png" alt="Cookies"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_sessions">3.9. Sessions</h3>
<div class="paragraph">
<p>Сессия позоляет сохранять некоторую информацию на время сеанса. Когда клиент обращается к сервлету или странице <code>JSP</code>, то движок сервлетов проверяет, определен ли в запросе параметр <code>ID</code> сессии. Если такой параметр неопределен (например, клиент первый раз обращается к приложению), тогда движок сервлетов создает уникальное значение <code>ID</code> и связанный с ним объект сессии. Объект сессии сохраняется на сервере, а <code>ID</code> отправляется в ответе клиенту и по умолчанию сохраняется на клиенте в куках. Затем когда приходит новый запрос от того же клиента, то движок сервлетов опять же может получить <code>ID</code> и сопоставить его с объектом сессии на веб-сервере.</p>
</div>
<div class="paragraph">
<p>Хотя по умолчанию <code>ID</code> сессии хранится в куках, но возможна ситуация, когда куки отключены на клиенте. Для решения этой проблемы есть ряд техник, в частности, добавление <code>ID</code> в адрес.</p>
</div>
<div class="paragraph">
<p>Для получения объекта сессии в сервлете у объекта <code>HttpServletRequest</code> определен метод <code>getSession()</code>. Он возвращает объект <code>HttpSession</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">HttpSession session = request.getSession();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Для управления сессией объект <code>HttpSession</code> предоставляет ряд методов:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>setAttribute(String name, Object o)</code> сохраняет в сессии под ключом <code>name</code></p>
</li>
<li>
<p><code>getAttribute(String name)</code> возвращает из сессии объект с ключом <code>name</code>. Если ключа <code>name</code> в сессии неопределено, то возвращается <code>null</code></p>
</li>
<li>
<p><code>removeAttribute(String name)</code> удаляет из сессии объект с ключом <code>name</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Например, определим следующий сервлет:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

@WebServlet("/hello")
public class HelloServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        // получаем сессию
        HttpSession session = request.getSession();
        // получаем объект name
        String name = (String) session.getAttribute("name");

        PrintWriter out = response.getWriter();
        try {
            // если объект ранее не установлен
            if (name == null) {
                // устанавливаем объект с ключом name
                session.setAttribute("name", "Tom Soyer");
                out.println("Session data are set");
            } else {
                out.println("Name: " + name);
                // удаляем объект с ключом name
                session.removeAttribute("name");
            }
        } finally {
            out.close();
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>В данном случае мы получаем из сессии объект с ключом <code>name</code>. Если он не определен, то добавляем его в сессию, если определен - то удаляем. Таким образом, при первом запросе к приложению, в сессию будут добавлены данные, а при втором удалены, но мы сможем увидеть эти данные:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/servlet/session.png" alt="Session"></span></p>
</div>
<div class="paragraph">
<p>Подобным образом можно сохранять в сессию более сложные объекты. Допустим, у нас есть следующий класс, который представляет пользователя:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class Person {
    private String name;
    private int age;

    public Person(String name, int age) {
        this.name = name;
        this.age = age;
    }

    public String getName() {
        return name;
    }

    public int getAge() {
        return age;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Сохраним в сессию и получим из сессии объект этого класса:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

@WebServlet("/hello")
public class HelloServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        HttpSession session = request.getSession();
        Person tom = (Person) session.getAttribute("person");

        PrintWriter out = response.getWriter();
        try {
            if (tom == null) {
                tom = new Person("Tom", 34);
                session.setAttribute("person", tom);
                out.println("Session data are set");
            } else {
                out.println("Name: " + tom.getName() + " Age: " + tom.getAge());
                session.removeAttribute("person");
            }
        } finally {
            out.close();
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>В данном случае также если объект по ключу <code>person</code> не установлен, то он устанавливается, иначе удаляется.</p>
</div>
<div class="sect3">
<h4 id="_дополнительные_методы_httpsession">3.9.1. Дополнительные методы <code>HttpSession</code></h4>
<div class="paragraph">
<p>Кроме выше рассмотренных методов <code>HttpSession</code> есть еще ряд методов, которые могут быть полезны. Некоторые из них:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getAttributeNames()</code> возвращает объект <code>java.util.Enumeration</code>, который содержит все ключи имеющих в сессии объектов</p>
</li>
<li>
<p><code>getId()</code> возвращает идентификатор сессии в виде строки</p>
</li>
<li>
<p><code>isNew()</code> возвращает <code>true</code>, если для клиента еще не установлена сессия (клиент сделал первый запрос или на клиенте отключены куки)</p>
</li>
<li>
<p><code>setMaxInactiveInterval(int seconds)</code> устанавливает интервал неактивности в секундах. И если в течение этого интервала клиент был неактивен, то данные сессии данные удаляются. По умолчанию максимальный интервал неактивности <code>1800</code> секунд. Значение <code>-1</code> указывает, что сессия удаляется только тогда, когда пользователь закрыл вкладку в браузере.</p>
</li>
<li>
<p><code>invalidate()</code> удаляет из сессии все объекты</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Применение методов:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">// получение всех ключей
Enumeration keys = session.getAttributeNames();
while (keys.hasMoreElements()) {
    System.out.println((String) keys.nextElement());
}

session.setMaxInactiveInterval(60 * 60 * 24); // установка интервала неактивности 1 день
session.setMaxInactiveInterval(-1); // до закрытия браузера

// удаление всех данных из сессии
session.invalidate();</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jakarta_server_pages">4. Jakarta Server Pages</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_what_is_jsp">4.1. What is JSP</h3>
<div class="paragraph">
<p><strong>Java Server Pages</strong> представляет технологию, которая позволяет создавать динамические веб-страницы. Изначально <strong>JSP</strong> (вместе с сервлетами) на заре развития <strong>Java EE</strong> являлись доминирующим подходом к веб-разработке на языке <strong>Java</strong>. И хотя в настоящее время они уступили свое место другой технологии - <strong>JSF</strong>, тем не менее <strong>JSP</strong> продолжают широко использоваться.</p>
</div>
<div class="paragraph">
<p>По сути <strong>Java Server Page</strong> или <strong>JSP</strong> представляет собой <strong>html</strong>-код с вкраплениями кода <strong>Java</strong>. В то же время станицы <strong>jsp</strong> - это не стандартные <strong>html</strong>-страницы. Когда приходит запрос к определенной странице <strong>JSP</strong>, то сервер обрабатывает ее, генерирует из нее код html и отправляет его клиенту. В итоге пользователь после обращения к странице <strong>JSP</strong> видит в своем браузере обычную <strong>html</strong>-страницу.</p>
</div>
<div class="paragraph">
<p>Как и обычные статические веб-страницы, файлы <strong>JSP</strong> необходимо размещать на веб-сервере, к которому обычные пользователи могут обращаться по протоколу <strong>http</strong>, например, набирая в адресной строке браузера нужный адрес. Однако чтобы сервер мог обрабатывать файлы <strong>JSP</strong>, он должен использовать движок <strong>JSP</strong> (<strong>JSP engine</strong>), который также называют <strong>JSP-контейнером</strong>. Есть множество движков <strong>JSP</strong>, и все они реализуют одну и ту же спецификацию и в целом работают одинаково. Однако тем не менее при переносе кода с одного веб-сервера на другой могут потребоваться небольшие изменения.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/jsp/shema-connection.png" alt="Shema connection"></span></p>
</div>
<div class="paragraph">
<p>В данном случае для работы с <strong>JSP</strong> мы будем использовать <strong>Apache Tomcat</strong>, который одновременно является и веб-сервером и контейнером сервлетов и <strong>JSP</strong>.
Создадим простейшую страницу <strong>JSP</strong>. Для этого где-нибудь на жестком диске определим файл <code>index.jsp</code>. Все станицы <strong>JSP</strong> имеют расширение <code>jsp</code>. Откроем этот файл в любом текстовом редакторе и определим в нем следующий код:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;%
String header = "Apache Tomcat";
%&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8" /&gt;
    &lt;title&gt;First JSP App&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h2&gt;&lt;%= header %&gt;&lt;/h2&gt;
    &lt;p&gt;Today &lt;%= new java.util.Date() %&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>С помощью тегов <code>&lt;% &#8230;&#8203; %&gt;</code> мы можем определить код <strong>Java</strong> на странице <strong>JSP</strong>. В данном случае мы просто определяем переменную типа <code>String</code>, которая называется <code>header</code>.</p>
</div>
<div class="paragraph">
<p>Затем идет стандартный код страницы <strong>html</strong>. Чтобы внедрить код <strong>java</strong> внутрь <strong>html</strong>-страницы применяются теги <code>&lt;%= %&gt;</code> - после знака равно указывается выражение Java, результат которого будет выводиться вместо этих тегов. В данном случае, используются две таких вставки. Первая вставка - значение переменной <code>header</code>, которая была определена выше. Вторая вставка - выражение new <code>java.util.Date()</code>, которое возвращает текущую дату.</p>
</div>
<div class="paragraph">
<p>Для тех, кто знаком с веб-разработкой на <strong>PHP</strong>, это может напоминать оформление файлов <code>php</code>, которые также содержать код <strong>html</strong> и код <strong>php</strong>.</p>
</div>
<div class="paragraph">
<p>Теперь поместим данный файл на сервер - в данном случае в контейнер <strong>Tomcat</strong>. Перейдем в <strong>Apache Tomcat</strong> к папке <code>webapps\ROOT</code>. Удалим из нее все содержимое и поместим нашу страницу <code>index.jsp</code>, которая была создана выше.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/jsp/index-jsp.png" alt="Index jsp"></span></p>
</div>
<div class="paragraph">
<p>Запустим <strong>Apache Tomcat</strong> (если он не запущен), и обратимся к приложению по адресу <code><a href="http://localhost:xxxx/index.jsp" class="bare">http://localhost:xxxx/index.jsp</a></code>, где <code>xxxx</code> - номер порта, по которому запущен <strong>Tomcat</strong>:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/jsp/page-jsp.png" alt="Page jsp"></span></p>
</div>
<div class="paragraph">
<p>В итоге <strong>Tomcat</strong> получит запрос к странице <code>index.jsp</code>, обработает код на <strong>java</strong>, сгенерирует <strong>html</strong>-страницу и отправит ее пользователю.</p>
</div>
<div class="paragraph">
<p>По умолчанию <strong>Apache Tomcat</strong> настроен таким образом, что все запросы к корню приложения по умолчанию обрабатываются страницей <code>index.jsp</code>, поэтому мы также можем обращаться к ней по адресу <code><a href="http://localhost:xxxx" class="bare">http://localhost:xxxx</a></code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_jsp_syntax_basics">4.2. JSP syntax basics</h3>
<div class="paragraph">
<p>:imagesdir:../../../assets/img/java/jakarta-ee/jsp/</p>
</div>
<div class="paragraph">
<p>Содержимое страницы <strong>JSP</strong> фактически делится на код <strong>html</strong> (а также <strong>css/javascript</strong>) и код на языке Java. Для вставки кода <strong>java</strong> на страницу <strong>JSP</strong> можно использовать пять основных элементов:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Выражения JSP</strong> (<strong>JSP Expression</strong>)</p>
</li>
<li>
<p><strong>Скриплет JSP</strong> (<strong>JSP Scriplet</strong>)</p>
</li>
<li>
<p><strong>Объявления JSP</strong> (<strong>JSP Declaration</strong>)</p>
</li>
<li>
<p><strong>Директивы JSP</strong> (<strong>JSP Directive</strong>)</p>
</li>
<li>
<p><strong>Комментарии JSP</strong></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_jsp_expression">4.2.1. JSP Expression</h4>
<div class="paragraph">
<p><strong>JSP Expression</strong> представляет выражение, заключенное между тегами <code>&lt;%=</code> и <code>%&gt;</code>. При обращении к <strong>JSP</strong> вычисляется значение этого выражения.</p>
</div>
<div class="paragraph">
<p>Например, определим следующую страницу <strong>JSP</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8" /&gt;
    &lt;title&gt;First JSP App&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;p&gt;2 + 2 = &lt;%= 2 + 2 %&gt;&lt;/p&gt;
    &lt;p&gt;5 &gt; 2 = &lt;%= 5 &gt; 2 %&gt;&lt;/p&gt;
    &lt;p&gt;&lt;%= new String("Hello").toUpperCase() %&gt;&lt;/p&gt;
    &lt;p&gt;Today &lt;%= new java.util.Date() %&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Здесь используются четыре <strong>JSP</strong>-выражения. Первое выражение - простая арифметическая операция сложения. При обработке страницы вместо</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;p&gt;2 + 2 = &lt;%= 2 + 2 %&gt;&lt;/p&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>будет сгенерирована следующая <code>html</code>-разметка:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;p&gt;2 + 2 = 4&lt;/p&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Второе выражение - операция сравнения во многом аналогична. Третье выражение - создание объекта <code>String</code> и вызов у него метода <code>toUpperCase()</code>, который возвращает строку в верхнем регистре. То есть выражение также может представлять вызов метода.</p>
</div>
<div class="paragraph">
<p>И четвертое выражение - вызов конструктора класса <code>Date</code>, который создает объект с текущей датой.</p>
</div>
<div class="paragraph">
<p>Когда придет запрос к этой странице, из нее будет сгенерирован следующий код:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset="UTF-8" /&gt;
        &lt;title&gt;First JSP App&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;p&gt;2 + 2 = 4&lt;/p&gt;
        &lt;p&gt;5 &gt; 2 = true&lt;/p&gt;
        &lt;p&gt;HELLO&lt;/p&gt;
        &lt;p&gt;Today Fri Aug 31 11:37:26 MSK 2018&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>И соответственно эту страницу мы увидим в браузере:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/jsp/jsp-syntax-basics1.png" alt="JSP syntax basics"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_jsp_scriplet">4.2.2. JSP Scriplet</h4>
<div class="paragraph">
<p><strong>JSP Scriplet</strong> представляет одну или несколько строк на языке Java. Скриплет заключается внутри следующих тегов:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;%
    код Java
%&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Например, определим следующую страницу <strong>JSP</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8" /&gt;
    &lt;title&gt;First JSP App&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;%
        for (int i = 1; i &lt; 5; i++) {
            out.println("&lt;br&gt;Hello " + i);
        }
    %&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>В данном случае скриплет представляет цикл <code>for</code>, в котором генерируется вывод с помощью метода <code>out.println()</code>. В итоге в браузере будет выведено четыре разо слово <code>Hello</code> с соответствующей цифрой:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/jsp/jsp-syntax-basics2.png" alt="JSP syntax basics"></span></p>
</div>
<div class="paragraph">
<p>Другой пример - определим переменную и массив и выведим их содержимое на страницу:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;%
    String[] people = new String[]{"Tom", "Bob", "Sam"};
    String header = "Users list";
%&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8" /&gt;
    &lt;title&gt;First JSP App&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h3&gt;&lt;%= header %&gt;&lt;/h3&gt;
    &lt;ul&gt;
    &lt;%
        for (String person: people) {
            out.println("&lt;li&gt;" + person + "&lt;/li&gt;");
        }
    %&gt;
    &lt;/ul&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>В скриплете в начале страницы определяются две переменных - переменная типа <code>String</code> и массив строк. С помощью второго скриплета содержимое массива через цикл <code>for</code> выводится на страницу.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/jsp/jsp-syntax-basics3.png" alt="JSP syntax basics"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_jsp_declaration">4.2.3. JSP Declaration</h4>
<div class="paragraph">
<p><strong>JSP Declaration</strong> позволяют определить метод, который мы затем можем вызывать в скриплетах или в <strong>JSP</strong>-выражениях. Определение метода помещается между тегами <code>&lt;%!</code> и <code>%&gt;</code>. Например, определим следующую <strong>JSP</strong>-страницу:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;%!
    int square(int n){
        return n * n;
    }
%&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8" /&gt;
    &lt;title&gt;First JSP App&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;p&gt;&lt;%= square(6) %&gt;&lt;/p&gt;
    &lt;ul&gt;
    &lt;%
        for(int i = 1; i &lt;= 5; i++){
            out.println("&lt;li&gt;" + square(i) + "&lt;/li&gt;");
        }
    %&gt;
    &lt;/ul&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>В данном случае метод <code>square()</code> возвращает квадрат числа. Затем этот метод используется в выражении <strong>JSP</strong> и в скриплете в цикле <code>for</code>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/jsp/jsp-syntax-basics4.png" alt="JSP syntax basics"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_директивы">4.2.4. Директивы</h4>
<div class="paragraph">
<p><strong>Директивы</strong> предназначены для установки условий, которые применяются ко всей странице <strong>JSP</strong>. Наиболее используемая директива - это директива <code>page</code>. Например, с помощью атрибута <code>import</code> этой директивы мы можем импортировать пакеты или отдельные классы на страницу <strong>JSP</strong>.</p>
</div>
<div class="paragraph">
<p>Например, в первом коде статьи для вывода даты использовалось выражение <code>new java.util.Date()</code>. Но мы можем использовать данное выражение на странице многократно, либо использовать другие классы из пакета <code>java.util</code>. И в этом случае мы можем импортировать нужные нам классы или пакеты:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;%@ page import="java.util.Data" %&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Импорт всего пакета:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;%@ page import="java.util.*" %&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Если необходимо импортировать несколько классов и(или) пакетов, то они перечисляются через запятую:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;%@ page import="java.util.Data, java.text.*" %&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Другой полезный и часто используемый атрибут - <code>pageEncoding</code>, который задает кодировку <strong>UTF-8</strong>. Например:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;%@ page import="java.util.Date" pageEncoding="UTF-8" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;JSP Application&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h2&gt;Сегодня: &lt;%= new Date() %&gt;&lt;/h2&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/jsp/jsp-syntax-basics5.png" alt="JSP syntax basics"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_комментарии">4.2.5. Комментарии</h4>
<div class="paragraph">
<p><strong>Комментарии JSP</strong> добавляются с помощью тега <code>&lt;%-- Текст_комментария --%&gt;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;%-- Первое приложение на JSP --%&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8" /&gt;
    &lt;title&gt;First JSP App&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h2&gt;Hello&lt;/h2&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>При этом внутри скриплета мы можем использовать стандартные для языка Java комментарии:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;%
    /*
        Пример цикла
        в JSP
    */
    // вывод строки Hello четыре раза
    for(int i = 1; i &lt; 5; i++){
        out.println("&lt;br&gt;Hello " + i);
}
%&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_java_classes_in_jsp">4.3. Using Java classes in JSP</h3>
<div class="paragraph">
<p>Страницы <strong>JSP</strong> могут включать некоторый код на Java. Таким образом, мы можем определять прямо в <strong>JSP</strong> переменные, методы, вообщем, некоторую логику. Однако если программной логики на Java довольно много, то лучше выносить ее в отдельные классы. Однако в данном случае может возникнуть вопрос, как организовать взаимодействие классов на <strong>Java</strong> и <strong>JSP</strong>. Рассмотрим этот вопрос.</p>
</div>
<div class="paragraph">
<p>В данном случае используем <strong>Eclipse</strong>. Создадим новый проект по типу <strong>Dynamic Web Project</strong> (как описано в прошлой теме) или возьмем уже имеющийся.</p>
</div>
<div class="paragraph">
<p>Допустим, в моем случае проект называется <code>hellojsp</code>. Перейдем в структуре проекта к узлу <code>Java Resources</code> и его под узлу <code>src</code>. Это тот узел, который хранит в проекте все классы на языке Java, которые мы хотим использовать в своем приложении.</p>
</div>
<div class="paragraph">
<p>Вначале добавим в папку <code>src</code> новый пакет, где будут располагаться классы. Поэтому нажмем на узел <code>src</code> правой кнопкой мыши и в контекстном меню выберем пункт <strong>New &#8594; Package</strong>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/jsp/create-package.png" alt="Creat package"></span></p>
</div>
<div class="paragraph">
<p>В появившемся окне укажем название пакета, например, <code>com.metanit.hellojsp</code>:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/jsp/create-package2.png" alt="Creat package"></span></p>
</div>
<div class="paragraph">
<p>Далее добавим в этот пакет новый класс. Для этого в структуре проекта нажмем на пакет правой кнопкой мыши и в контекстном меню выберем пункт <strong>New &#8594; Class</strong>:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/jsp/create-servlet.png" alt="Creat servlet"></span></p>
</div>
<div class="paragraph">
<p>В окне добавления нового класса дадим ему имя <code>Calculator</code> (имя может быть произвольным). Остальные опции оставим по умолчанию.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/jsp/create-javabean.png" alt="Create JavaBean"></span></p>
</div>
<div class="paragraph">
<p>Далее определим в файле <code>Calculator.java</code> следующий код:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">package com.metanit.hellojsp;

public class Calculator {
    public int square (int n) {
        return n * n;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>В данном случае для простоты примера класс содержит один метод, который возводит число в квадрат.</p>
</div>
<div class="paragraph">
<p>Теперь определим в проекте в папке <code>WebContent</code> файл <strong>jsp</strong>, например, <code>hello.jsp</code>. Используем на странице <code>hello.jsp</code> класс <code>Calculator</code>. Для этого определим в <code>hello.jsp</code> следующий код:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;%@page import="com.metanit.hellojsp.Calculator"%&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8" /&gt;
    &lt;title&gt;JSP Application&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h2&gt;Square of 3 = &lt;%= new Calculator().square(3) %&gt;&lt;/h2&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вначале с помощью директивы <code>@page</code> подключается класс <code>com.metanit.hellojsp.Calculator</code>. Затем его метод <code>square()</code> используется на странице.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/jsp/hello-jsp.png" alt="Hello JSP"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_вложение_jsp_страниц">4.4. Вложение jsp-страниц</h3>
<div class="paragraph">
<p>В одну <strong>JSP</strong>-страницу можно вставлять несколько других. Это позволяет определять некоторые общие блоки для всех страниц и использовать их повторно на нескольких страницах <strong>JSP</strong>.</p>
</div>
<div class="paragraph">
<p>Для этого применяется специальный тег <code>jsp:include</code>, который может использоваться как обычный html-элемент на страницах <strong>JSP</strong>.</p>
</div>
<div class="paragraph">
<p>Определим следующий проект.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/jsp/project.png" alt="Project"></span></p>
</div>
<div class="paragraph">
<p>Допустим, у нас есть файл <code>header.html</code> с простейшим кодом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;nav&gt;&lt;a href="#"&gt;Home&lt;/a&gt; | &lt;a href="#"&gt;Contact&lt;/a&gt; | &lt;a href="#"&gt;About&lt;/a&gt;&lt;/nav&gt;
&lt;h2&gt;Hello JSP&lt;/h2&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>В данном случае здесь определен обычный код <strong>html</strong>.</p>
</div>
<div class="paragraph">
<p>Также пусть в проекте будет определен файл <code>footer.jsp</code> со следующим содержимым:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;p&gt;Copyright ©Simon &amp; Schuster, Inc. 2002.&lt;/p&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>В данном случае мы определили два файла, которые представляют соответственно условный хедер и условный футер - части стандартной веб-страницы.</p>
</div>
<div class="paragraph">
<p>И также определим в проекте файл <code>index.jsp</code> со следующим кодом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset="UTF-8" /&gt;
        &lt;title&gt;JSP Application&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;jsp:include page="header.html" /&gt;
        &lt;p&gt;Main Content 1&lt;/p&gt;
        &lt;p&gt;Main Content 2&lt;/p&gt;
        &lt;p&gt;Main Content 3&lt;/p&gt;
        &lt;jsp:include page="footer.jsp" /&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>С помощью тега <code>jsp:include</code> содержимое обоих файлов вставляется в данную <strong>jsp-страницу</strong>. Атрибут <code>page</code> указывает на адрес вставляемого файла. Причем это может быть и обычная <strong>html-страница</strong>, и <strong>jsp-файл</strong>.</p>
</div>
<div class="paragraph">
<p>При обращении к странице <code>index.jsp</code> мы сможем увидеть на странице содержимое вставляемых файлов:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/jsp/result.png" alt="Result"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_получение_отправленных_форм">4.5. Получение отправленных форм</h3>
<div class="paragraph">
<p>Станицы <strong>JSP</strong> могут получать отправленные данные, например, через параметры или в виде отправленных форм, так же, как это происходит в сервлете. Для этого внутри страницы <strong>jsp</strong> доступен объект <code>request</code>, который позволяет получить данные посредством следующих методов:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getParameter(String param)</code> возвращает значение определенного параметра, название которого передается в метод. Если указанного параметра в запросе нет, то возвращается значение <code>null</code>.</p>
</li>
<li>
<p><code>getParameterValues(String param)</code> возвращает массив значений, который представляет определенный параметр. Если указанного параметра в запросе нет, то возвращается значение <code>null</code>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_получение_данных_из_строки_запроса_2">4.5.1. Получение данных из строки запроса</h4>
<div class="paragraph">
<p>Например, определим в проекте файл <code>postuser.jsp</code>, который будет получать отправленные в запросе данные:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset="UTF-8" /&gt;
        &lt;title&gt;User Info&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;p&gt;Name: &lt;%= request.getParameter("name") %&gt;&lt;/p&gt;
        &lt;p&gt;Age: &lt;%= request.getParameter("age") %&gt;&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>В данном случае мы получаем два параметра: <code>name</code> и <code>age</code>.</p>
</div>
<div class="paragraph">
<p>Запустим приложение и передадим странице данные через строку запроса <code>postuser.jsp?name=Bob&amp;age=29</code>:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/jsp/request-with-params.png" alt="Request with params"></span></p>
</div>
<div class="paragraph">
<p>Если для определенного параметра не передается значение, то страница получает значене <code>null</code>:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/jsp/request-with-params2.png" alt="Request with params"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_получение_данных_из_форм_2">4.5.2. Получение данных из форм</h4>
<div class="paragraph">
<p>Подобным образом можно получать данные из отправленных форм. Например, определим в проекте файл <code>index.html</code> с формой ввода:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;User Form&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form action="postuser.jsp"&gt;
        Name: &lt;input name="name" /&gt;
        &lt;br&gt;
        Age: &lt;input name="age" type="number" min=1 /&gt;
        &lt;br&gt;
        &lt;input type="submit" value="Submit" /&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>В данном случае форма предназначена для ввода имени и возаста пользователя. И по нажатию на кнопку данные формы уходят странице <code>postuser.jsp</code>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/jsp/postuser-jsp.png" alt="JSP postuser"></span></p>
</div>
<div class="paragraph">
<p>Таким образом, после ввода данных и их отправке на странице <code>index.html</code> эти данные будут получены скриптом <code>postuser.jsp</code>:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/jsp/page-with-form.png" alt="JSP with form"></span></p>
</div>
<div class="paragraph">
<p>Рассмотрим отправку более сложной формы. Определим в файле <code>index.html</code> следующий код:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;User Form&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form action="postuser.jsp" method="POST"&gt;
        Name: &lt;input name="username" /&gt;
        &lt;br&gt;
        Gender: &lt;input type="radio" name="gender" value="female" checked /&gt;Female
        &lt;input type="radio" name="gender" value="male" /&gt;Male
        &lt;br&gt;
        Country: &lt;select name="country"&gt;
            &lt;option&gt;Iran&lt;/option&gt;
            &lt;option&gt;Turkey&lt;/option&gt;
            &lt;option&gt;China&lt;/option&gt;
            &lt;option&gt;Germany&lt;/option&gt;
        &lt;/select&gt;
        &lt;br&gt;
        Courses:
        &lt;input type="checkbox" name="courses" value="JavaSE" checked /&gt;Java SE
        &lt;input type="checkbox" name="courses" value="JavaFX" checked /&gt;Java FX
        &lt;input type="checkbox" name="courses" value="JavaEE" checked /&gt;Java EE
        &lt;br&gt;
        &lt;input type="submit" value="Submit" /&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Здесь имеется сразу несколько полей ввода - обычное текстовое поле, выпадающий список <code>select</code>, набор радиокнопок и набор элементов <code>checkbox</code>, где пользователь одновременно может выбрать сразу несколько полей.</p>
</div>
<div class="paragraph">
<p>Для обработки этой формы определим в <code>postuser.jsp</code> следующий код:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8" /&gt;
    &lt;title&gt;User Info&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;p&gt;Name: &lt;%= request.getParameter("username") %&gt;&lt;/p&gt;
    &lt;p&gt;Country: &lt;%= request.getParameter("country") %&gt;&lt;/p&gt;
    &lt;p&gt;Gender: &lt;%= request.getParameter("gender") %&gt;&lt;/p&gt;
    &lt;h4&gt;Selected courses&lt;/h4&gt;
    &lt;ul&gt;
    &lt;%
        String[] courses = request.getParameterValues("courses");
        for(String course: courses){
            out.println("&lt;li&gt;" + course + "&lt;/li&gt;");
        }
    %&gt;
    &lt;/ul&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Для тех полей, которые допускают выбор одного значения или представляют одно значение, все идентично: после слова <code>param</code> через точку указывается название поля. Но, например, набор чекбоксов имеет одно и то же имя - <code>courses</code> и позволяет выбрать сразу несколько значений. Эти значения мы можем получить в <strong>JSP</strong> через массив:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">String[] courses = request.getParameterValues("courses");</code></pre>
</div>
</div>
<div class="paragraph">
<p>И затем можно использовать цикл <code>for</code> для перебора массива и вывода на страницу его элементов.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/jsp/page-with-form2.png" alt="Page with form"></span></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_передача_данных_из_сервлета_в_jsp">4.6. Передача данных из сервлета в jsp</h3>
<div class="paragraph">
<p>Нередко страница <strong>jsp</strong> обрабатывает запрос вместе сервлетом. В этом случае сервлет определяет логику, а <strong>jsp</strong> - визуальную часть. И при обработке запроса сервлет может перенаправить дальнейшую обработку странице <strong>jsp</strong>. Соответственно может возникнуть вопрос, как передать данные из сервлета в <strong>jsp</strong>?</p>
</div>
<div class="paragraph">
<p>Есть несколько способов передачи данных из сервлета в <strong>jsp</strong>, которые заключаются в использовании определенного контекста или <strong>scope</strong>. Есть несколько контекстов для передачи данных:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>request</strong> (<strong>контекст запроса</strong>) данные сохраняются в <code>HttpServletRequest</code></p>
</li>
<li>
<p><strong>session</strong> (<strong>контекст сессии</strong>) данные сохраняются в <code>HttpSession</code></p>
</li>
<li>
<p><strong>application</strong> (<strong>контекст приложения</strong>) данные сохраняются в <code>ServletContext</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Данные из контекста запроса доступны только в пределах текущего запроса. Данные из контекста сессии доступны только в пределах текущего сеанса. А данные из контекста приложения доступны постоянно, пока работает приложение.</p>
</div>
<div class="paragraph">
<p>Но вне зависимости от выбранного способа передача данных осуществляется с помощью метода <code>setAttribute(name, value)</code>, где <code>name</code> - строковое название данных, а <code>value</code> - сами данные, которые могут представлять различные данные.</p>
</div>
<div class="paragraph">
<p>Наиболее распространенный способ передачи данных из сервлета в <strong>jsp</strong> представляют атрибуты запроса. То есть у объекта <code>HttpServletRequest</code>, который передается в сервлет, вызывается метод <code>setAttribute()</code>. Этот метод устанавливает атрибут, который можно получить в <strong>jsp</strong>.</p>
</div>
<div class="paragraph">
<p>Например, добавим в проект страницу <code>basic.jsp</code> со следующим кодом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
&lt;title&gt;JSP Application&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;p&gt;Name: ${name}&lt;/p&gt;
    &lt;p&gt;Age: ${age}&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>В <code>basic.jsp</code> можно получить атрибуты <code>name</code> и <code>age</code> и вывести их значение на страницу. Для вывода атрибутов применяется специальный синтаксис <strong>EL</strong>: в фигурные скобки <code>{}</code> заключается выводимое значение.</p>
</div>
<div class="sect3">
<h4 id="_контекст_запроса">4.6.1. Контекст запроса</h4>
<div class="paragraph">
<p>Определим сервлет <code>HelloServlet</code>, который передает запрос <code>basic.jsp</code> и передает ей данные:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@WebServlet("/hello")
public class HelloServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        request.setAttribute("name", "Tom");
        request.setAttribute("age", 34);

        getServletContext().getRequestDispatcher("/basic.jsp").forward(request, response);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Сервлет устанавливает два атрибута - <code>name</code> и <code>age</code> через объект <code>HttpServletRequest</code> и затем перенаправляет запрос странице <code>basic.jsp</code>.</p>
</div>
<div class="paragraph">
<p>Если мы обратимся к сервлету <code>HelloServlet</code>, то он передаст запрос и данные странице <code>basic.jsp</code>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/jsp/jsp-hello.png" alt="JSP hello"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_контекст_приложения">4.6.2. Контекст приложения</h4>
<div class="paragraph">
<p>Использование контекста приложения представляет применение объекта <code>ServletContext</code>, который можно получить в сервлете с помощью метода <code>getServletContext()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.io.IOException;

import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@WebServlet("/hello")
public class HelloServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        ServletContext selvletContext = getServletContext();
        selvletContext.setAttribute("name", "Tom");
        selvletContext.setAttribute("age", 35);

        getServletContext().getRequestDispatcher("/basic.jsp").forward(request, response);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Код страницы <code>basic.jsp</code> при этом не меняется.</p>
</div>
</div>
<div class="sect3">
<h4 id="_контекст_сессии">4.6.3. Контекст сессии</h4>
<div class="paragraph">
<p>Подобным образом можно передать данные в <strong>jsp</strong> через сессию:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

@WebServlet("/hello")
public class HelloServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        HttpSession session = request.getSession();
        session.setAttribute("name", "Tom");
        session.setAttribute("age", 34);

        getServletContext().getRequestDispatcher("/basic.jsp").forward(request, response);
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jakarta_standard_tag_library">5. Jakarta Standard Tag Library</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_jstl">5.1. JSTL</h3>
<div class="paragraph">
<p><strong>JSP</strong> по умолчанию позволяет встраивать код на java в разметку html. Однако иногда использование стандартных способов для ряда операций, например, для ывод на страницу элементов из списка и т.д., может быть несколько громоздким. Чтобы упростить встраивание кода java в JSP была разработана специальная библиотека - <strong>JSTL</strong>. <strong>JSTL</strong> (<strong>JSP Standard Tag Library</strong>) предоставляет теги для базовых задач JSP (цикл, условные выражения и т.д.)</p>
</div>
<div class="paragraph">
<p>Эта библиотека не является частью инфраструктуры Java EE, поэтому ее необходимо добавлять в проект самостоятельно. Библиотеку можно найти по адресу <a href="http://central.maven.org/maven2/javax/servlet/jstl/1.2/">maven artifact</a>. Из репозитория нам необходимо загрузить файл <strong>jstl-1.2.jar</strong>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/jstl/jstl1.png" alt="download jstl in java ee"></span></p>
</div>
<div class="paragraph">
<p>В проекте Eclipse эту библиотеку необходимо добавить в папку  <strong>WebContent/WEB-INF/lib</strong>:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/jstl/jstl2.png" alt="JSTL в Java EE"></span></p>
</div>
<div class="paragraph">
<p>Несмотря на то, что JSTL часто называется библиотекой, на самом деле она содержит ряд библиотек:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Core</strong>: содержит основные теги для наиболее распространенных задач. Использует префикс <code>c</code> и uri <code><a href="http://java.sun.com/jsp/jstl/core" class="bare">http://java.sun.com/jsp/jstl/core</a></code></p>
</li>
<li>
<p><strong>Formatting</strong>: предоставляет теги для форматирования чисел, дат, времени. Использует префикс <code>fmt</code> и uri <code><a href="http://java.sun.com/jsp/jstl/fmt" class="bare">http://java.sun.com/jsp/jstl/fmt</a></code></p>
</li>
<li>
<p><strong>SQL</strong>: предоставляет теги для sql-запросами и источниками данных. Использует префикс <code>sql</code> и uri <code><a href="http://java.sun.com/jsp/jstl/sql" class="bare">http://java.sun.com/jsp/jstl/sql</a></code></p>
</li>
<li>
<p><strong>XML</strong>: предоставляет теги для работы с xml. Использует префикс <code>x</code> и uri <code><a href="http://java.sun.com/jsp/jstl/xml" class="bare">http://java.sun.com/jsp/jstl/xml</a></code></p>
</li>
<li>
<p><strong>Functions</strong>: предоставляет функции для работы со строками. Использует префикс <code>fn</code> и uri <code><a href="http://java.sun.com/jsp/jstl/functions" class="bare">http://java.sun.com/jsp/jstl/functions</a></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Для подключения функционала этих библиотек на страницу jsp применяется директива  <strong>taglib</strong>. Например, подключения основной библиотеки:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Рассмотрим некоторые базовые и наиболее используемые возможности JSTL.</p>
</div>
<div class="sect3">
<h4 id="_защита_от_внедрения_кода">5.1.1. Защита от внедрения кода</h4>
<div class="paragraph">
<p>Стандартный синтаксис EL не позволяет нам экранировать теги. Например, допустим, в сервлете в jsp передается некоторый текст, который содержит код html:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class HelloServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
        throws ServletException, IOException {
        request.setAttribute("message", "&lt;script&gt;alert('Hello gold')&lt;/script&gt;");
        getServletContext().getRequestDispatcher("/index.jsp").forward(request, response);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Передаваемая здесь строка содержит javascript-код, который отображает диалоговое окно. Но естественно код мог бы быть менее безобидным. И если в jsp для вывода атрибута message применяется только стандартный <strong>EL</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;p&gt;${message}&lt;/p&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>то в результате этот html-код будет внедрен напрямую в страницу:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/jstl/jstl3.png" alt="XSS in JSP in Java EE"></span></p>
</div>
<div class="paragraph">
<p>Теперь используем возможности JSTL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8" /&gt;
    &lt;title&gt;JSTL&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;p&gt;&lt;c:out value="${message}" /&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Тег <code>c:out</code> позволяет декодировать теги html. Его атрибут <code>value</code> указывает на выводимое значение. В итоге мы получим совсем другой вывод:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/jstl/jstl4.png" alt="Защита от XSS в JSP в Java EE"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_значение_по_умолчанию">5.1.2. Значение по умолчанию</h4>
<div class="paragraph">
<p>Через атрибуты сервлет передает данные в <strong>JSP</strong>. Однако вполне возможно, что из-за каких-то условий нужное значение не будет передано. В этом случае мы можем установить для тега <code>&lt;c:out&gt;</code> значение по умолчанию, используя его параметр  <code>default</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;p&gt;&lt;c:out value="${message2}" default="Hello world"/&gt;&lt;/p&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>И если значение для атрибута <code>message2</code> не передано, то для него будет использоваться строка <code>"Hello world"</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_основные_возможности_jstl">5.2. Основные возможности JSTL</h3>
<div class="paragraph">
<p>Рассмотрим некоторые основные возможности <strong>JSTL</strong>.</p>
</div>
<div class="sect3">
<h4 id="_цикл">5.2.1. Цикл</h4>
<div class="paragraph">
<p>Вывод в цикле элементов массива или коллекции:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;c:forEach var="user" items="${users}"&gt;
    &lt;p&gt;${user}&lt;/p&gt;
&lt;/c:forEach&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>В данном случае параметр <code>items</code> указывает на коллекцию, элементы которой выводятся. А параметр <code>var</code> задает переменную, через которую доступен текущий перебираемый элемент.</p>
</div>
<div class="paragraph">
<p>Например, в сервлет передается массив строк:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class HelloServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
        throws ServletException, IOException {
        String[] users = new String[]{"Tom", "Bob", "Sam"};
        request.setAttribute("users", users);
        getServletContext().getRequestDispatcher("/index.jsp").forward(request, response);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>В jsp мы можем получить и вывести элементы массива следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8" /&gt;
    &lt;title&gt;User Info&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;ul&gt;
        &lt;c:forEach var="user" items="${users}"&gt;
            &lt;li&gt;&lt;c:out value="${user}" /&gt;&lt;/li&gt;
        &lt;/c:forEach&gt;
    &lt;/ul&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/jstl/jstl5.png" alt="Цикл в JSTL в JSP"></span></p>
</div>
<div class="paragraph">
<p>Еще один пример - вывод в цикле всех куки:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;ul&gt;
&lt;c:forEach var="cook" items="${cookie}"&gt;
    &lt;li&gt;
        &lt;p&gt;&lt;c:out value="${cook.value.name}" /&gt;&lt;/p&gt;
        &lt;p&gt;&lt;c:out value="${cook.value.value}" /&gt;&lt;/p&gt;
    &lt;/li&gt;
&lt;/c:forEach&gt;
&lt;/ul&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_условные_выражения">5.2.2. Условные выражения</h4>
<div class="paragraph">
<p>Выражение <code>if</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;c:if test="${isVisible == true}"&gt;
    &lt;p&gt;Visible&lt;/p&gt;
&lt;/c:if&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>В данном случае если атрибут <code>isVisible</code> равен <code>true</code>, то выводится код, который расположен между тегами <code>&lt;c:if&gt;</code> и <code>&lt;/c:if&gt;</code></p>
</div>
<div class="paragraph">
<p>Если надо задать альтернативную логику, то можно добавить тег <code>c:if</code>, который проверяет противоположное условие:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;c:if test="${isVisible == true}"&gt;
    &lt;p&gt;Visible&lt;/p&gt;
&lt;/c:if&gt;
&lt;c:if test="${isVisible == false}"&gt;
    &lt;p&gt;Invisible&lt;/p&gt;
&lt;/c:if&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_тег_choose">5.2.3. Тег <code>choose</code></h4>
<div class="paragraph">
<p>Тег  <code>c:choose</code>  подобно конструкции switch&#8230;&#8203;case в Java проверяет объект на соответствие одному из значений. Например</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8" /&gt;
    &lt;title&gt;JSTL in JSP&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;c:choose&gt;
    &lt;c:when test="${val == 1}"&gt;
        &lt;p&gt;Equals to 1&lt;/p&gt;
    &lt;/c:when&gt;
    &lt;c:when test="${val == 2}"&gt;
        &lt;p&gt;Equals to 2&lt;/p&gt;
    &lt;/c:when&gt;
    &lt;c:otherwise&gt;
        &lt;p&gt;Undefined&lt;/p&gt;
    &lt;/c:otherwise&gt;
    &lt;/c:choose&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>В данном случае тег <code>c:choose</code> проверяет значение атрибута <code>val</code>. Для проверки применяются вложенные теги  <code>c:when</code>, которые аналогичны блокам <code>case</code> в конструкции <code>switch..case</code>. С помощью их параметра  <code>test</code>  значение атрибута сравнивается с определенным значением. И если выражения сравнения истинно, то выводится код, который размещен внутри данного элемента <code>c:when</code>. Таким образом мы можем определить несколько блоков <code>c:when</code>. Дополнительный тег <code>&lt;c:otherwise&gt;</code> выполняется, если условия проверки значения во всех тегах <code>c:when</code> ложно.</p>
</div>
</div>
<div class="sect3">
<h4 id="_тег_url">5.2.4. Тег url</h4>
<div class="paragraph">
<p>Тег <code>&lt;c:url&gt;</code> позволяет создать адрес относительно корня приложения. Этот тег может применяться, например, при создании ссылок.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8" /&gt;
    &lt;title&gt;JSTL in JSP&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;a href='&lt;c:url value="/edit" /&gt;'&gt;&lt;c:url value="/edit" /&gt;&lt;/a&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Параметр <code>value</code> содержит часть адреса, которая добавляется к корню приложения.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/jstl/jstl6.png" alt="url in JSTL in JSP"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_redirect">5.2.5. <code>redirect</code></h4>
<div class="paragraph">
<p>С помощью тега  <code>redirect</code>  можно установить редирект на другой адрес. Например, в случае если атрибут <code>val</code> не определен, то делаем редирект на страницу <code>notfound.jsp</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;c:if test="${val == null}"&gt;
    &lt;c:redirect url="/notfound.jsp" /&gt;
&lt;/c:if&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jakarta_expression_language">6. Jakarta Expression Language</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_expression_language">6.1. Expression Language</h3>
<div class="paragraph">
<p><strong>Expression Language</strong> или сокращенно <strong>EL</strong> предоставляет компактный синтаксис для обращения к массивам, коллекциям, объектам и их свойствам внутри страницы <strong>jsp</strong>. Он довольн прост. Вставку окрывает знак <code>$</code>, затем в фигурные скобки <code>{}</code> заключается выводимое значение:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">${attribute}
${object.property}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_поиск_данных">6.1.1. Поиск данных</h4>
<div class="paragraph">
<p>Откуда эти данные берутся? <strong>EL</strong> пытается найти значения для этих данных во всех доступных контекстах.</p>
</div>
<div class="paragraph">
<p>И <strong>EL</strong> просматривает все эти контексты в следующем порядке:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Контекст страницы (данные сохраняются в <code>PageContext</code>)</p>
</li>
<li>
<p>Контекст запроса</p>
</li>
<li>
<p>Контекст сессии</p>
</li>
<li>
<p>Контекст приложения</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Соответственно, если контексты запроса и сессии содержат атрибут с одним и тем же именем, то будет использоваться атрибут из контекста запроса.</p>
</div>
<div class="paragraph">
<p>Затем найденное значение (если оно было найдено) конвертируется в строку и выводится на страницу.</p>
</div>
<div class="paragraph">
<p>Следует отметить, что мы не можем определить данные на странице, например, с помощью скриплета и затем вывести через <strong>EL</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;%
    String name = "Tom";
%&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;JSP Application&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;p&gt;Name: ${name}&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Такой способ не будет работать. Если мы хотим определить данные непосредственно на страницы, то их затем необходимо включить в контекст страницы, который доступен через переменную <code>pageContext</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;%
    pageContext.setAttribute("name", "Tom");
%&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;JSP Application&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;p&gt;Name: ${name}&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Однако может сложиться ситуация, что сразу в нескольких контекстах одновременно содержатся данные с одним и тем же именем, например, <code>name</code>. Соответственно <strong>EL</strong> будет получать данные в порядке просмотра контекстов. Но, возможно, нам захочется выводить данные из какого-то определенного контекста. В этом случае перед названием данных мы можем указать название контекста: <code>pageScope</code>, <code>requestScope</code>, <code>sessionScope</code> или <code>applicationScope</code>. Например:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;%
    pageContext.setAttribute("name", "Bob");
%&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;JSP Application&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;p&gt;Name: ${requestScope.name}&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_передача_сложных_объектов">6.1.2. Передача сложных объектов</h4>
<div class="paragraph">
<p>Подобным образом мы можем передать и более сложные данные - списки, массивы, сложные объекты. Допустим, в сервлете на страницу передается массив:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@WebServlet("/hello")
public class HelloServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        String[] users = new String[] {"Tom", "Bob", "Sam"};
        request.setAttribute("users", users);
        getServletContext().getRequestDispatcher("/basic.jsp").forward(request, response);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>И на странице <code>basic.jsp</code> получаем переданные данные:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset="UTF-8"&gt;
    &lt;title&gt;JSP Application&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;p&gt;Second: ${users[1]}&lt;/p&gt;
    &lt;p&gt;Third: ${users[2]}&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вместо массива в сервлете мы могли бы передать более гибкий объект - <code>ArrayList</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">ArrayList&lt;String&gt; users = new ArrayList&lt;String&gt;();
Collections.addAll(users, "Tom", "Bob", "Sam");
request.setAttribute("users", users);</code></pre>
</div>
</div>
<div class="paragraph">
<p>В этом случае в <strong>jsp</strong> мы могли бы получить эти данные так же, как и из массива.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_встроенные_объекты_expression_language">6.2. Встроенные объекты Expression Language</h3>
<div class="paragraph">
<p>По умолчанию <strong>Expression Language</strong> предоставляет ряд встроенных объектов, которые позволяют использовать различные аспекты запроса:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>param</code> объект, который хранит все переданные странице параметры</p>
</li>
<li>
<p><code>paramValues</code> хранит массив значений для определенного параметра (если для параметра передается сразу несколько значений)</p>
</li>
<li>
<p><code>header</code> хранит все заголовки запроса</p>
</li>
<li>
<p><code>headerValues</code> предоставляет массив значений для определенного заголовка запроса</p>
</li>
<li>
<p><code>cookie</code> предоставляет доступ к отправленным в запросе кукам</p>
</li>
<li>
<p><code>initParam</code> возвращает значение для определенного параметра из элемента <code>context-param</code> из файла <code>web.xml</code></p>
</li>
<li>
<p><code>pageContext</code> предоставляет доступ к объекту <code>PageContext</code>, который представляет контекст текущей страницы jsp</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_получение_параметров_запроса">6.2.1. Получение параметров запроса</h4>
<div class="paragraph">
<p>Определим следующую страницу <code>postuser.jsp</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset="UTF-8" /&gt;
        &lt;title&gt;User Info&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;p&gt;Name: ${param.name}&lt;/p&gt;
        &lt;p&gt;Age: ${param.age}&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Через объект param здесь получаем из запроса значения параметров name и age. Значения для параметров можно передать как через строку запроса, так и через отправку формы. Например, передача через строку запроса:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/el/el-jsp.png" alt="Expression Language in JSP"></span></p>
</div>
<div class="paragraph">
<p>Также мы можем определить форму, например:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;User Form&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form action="postuser.jsp" method="post"&gt;
        Name: &lt;input name="name" /&gt;
        &lt;br&gt;&lt;br&gt;
        Age: &lt;input name="age" type="number" min=1 /&gt;
        &lt;br&gt;&lt;br&gt;
        &lt;input type="submit" value="Submit" /&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>И через эту форму передать данные в jsp:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/el/params-el.png" alt="Params in Expression Language"></span></p>
</div>
<div class="paragraph">
<p>Если с одним параметром связано несколько значений, то можно использовать объект <code>paramValues</code>. Например, на станице html есть форма, где пользователь может ввести несколько своих телефонов:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;User Form&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form action="postuser.jsp" method="post"&gt;
        Name: &lt;input name="name" /&gt;
        &lt;br&gt;&lt;br&gt;
        Main Phone: &lt;input name="phone" /&gt;
        &lt;br&gt;&lt;br&gt;
        Additional Phone: &lt;input name="phone" /&gt;
        &lt;br&gt;&lt;br&gt;
        &lt;input type="submit" value="Submit" /&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>И на странице <code>postuser.jsp</code> мы можем получить все введенные телефоны через <code>paramValues</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8" /&gt;
    &lt;title&gt;User Info&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;p&gt;Name: ${param.name}&lt;/p&gt;
    &lt;p&gt;Phone 1: ${paramValues.phone[0]}&lt;/p&gt;
    &lt;p&gt;Phone 2: ${paramValues.phone[1]}&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>После <code>paramValues</code> идет название параметра, причем параметр фактически представляет массив, и через индексы мы можем получить отдельные введенные данные.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/java/jakarta-ee/el/param-values-jsp.png" alt="ParamValues in JSP in Java EE"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_получение_куки">6.2.2. Получение куки</h4>
<div class="paragraph">
<p>Допустим, в сервлете устанавливаются куки:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class HelloServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        Cookie cookie = new Cookie("userName", "Sam");
        response.addCookie(cookie);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Получение этой куки в jsp:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Java Server Page&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div&gt;
        &lt;p&gt;From cookie: ${cookie.userName.value}&lt;/p&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_получение_заголовков_http">6.2.3. Получение заголовков HTTP</h4>
<div class="paragraph">
<p>Получим даные о юзер-агенте пользователя:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset="UTF-8" /&gt;
        &lt;title&gt;User Info&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;p&gt;User-Agent: ${header["User-Agent"]}&lt;/p&gt;
        &lt;p&gt;Host: ${header.host}&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Если название заголовка представляет сложное слово с дефисами, как <code>User-Agent</code>, то для получения его значения используется конструкция <code>header["название_заголовка"]</code></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_javabean">7. JavaBean</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_javabeans">7.1. JavaBeans</h3>
<div class="paragraph">
<p>Класс <strong>JavaBean</strong> должен соответствовать ряду ограничений:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>иметь конструктор, который не принимает никаких параметров</p>
</li>
<li>
<p>определять для всех свойств, которые используются в <strong>jsp</strong>, методы геттеры и сеттеры</p>
</li>
<li>
<p>названия геттеров и сеттеров должны соответствовать условностям: перед именем переменной добавляется <code>get</code> (для геттера) и <code>set</code> (для сеттера), а название переменной включается с большой буквы. Например, если переменная называется <code>firstName</code>, то функции геттера и сеттера должны называться соответственно <code>getFirstName()</code> и <code>setFirstName()</code>.</p>
</li>
<li>
<p>для переменных типа <code>boolean</code> для функции геттера используется вместо <code>get</code> приставка <code>is</code>. Например, переменная <code>enabled</code> и геттер <code>isEnabled()</code>.</p>
</li>
<li>
<p>реализовать интерфейс <code>Serializable</code> или <code>Externalizable</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Рассмотрим, как использовать классы <strong>JavaBean</strong>. Допустим, у нас есть следующая структура:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/assets/img/java/jakarta-ee/javabeans/file-javabean.png" alt="Project structure"></span></p>
</div>
<div class="paragraph">
<p>В папке <code>Java Resources/src</code> расположен класс <code>User</code> со следующим кодом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.io.Serializable;

public class User implements Serializable {
    private static final long serialVersionUID = 2041275512219239990L;

    private String name;
    private int age;

    public User() {
        this.name = "";
        this.age = 0;
    }

    public User(String name, int age) {
        this.name = name;
        this.age = age;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Данный класс представляет пользователя и является классом <strong>JavaBean</strong>: он реализует интерфейс <code>Serializable</code>, имеет конструктор без параметров, а его методы - геттеры и сеттеры, которые предоставляют доступ к переменным <code>name</code> и <code>age</code>, соответствуют условностям.</p>
</div>
<div class="paragraph">
<p>В папке <code>WebContent</code> определена страница <code>user.jsp</code>. Определим в ней следующий код:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;User Java Bean Page&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div&gt;
		&lt;p&gt;Name: ${user.name}&lt;/p&gt;
		&lt;p&gt;Age: ${user.age}&lt;/p&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Данная страница <strong>jsp</strong> получает извне объект <code>user</code> и с помощью синтаксиса <strong>EL</strong> выводит значения его свойств. Стоит обратить внимание, что здесь идет обращение к переменным <code>name</code> и <code>age</code>, хотя они являются приватными.</p>
</div>
<div class="paragraph">
<p>В папке <code>Java Resources/src</code> в файле <code>HelloServlet.java</code> определен сервлет <code>HelloServlet</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@WebServlet("/hello")
public class HelloServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        User tom = new User("Tom", 25);
        request.setAttribute("user", tom);
        getServletContext().getRequestDispatcher("/user.jsp")
                .forward(request, response);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Сервлет создает объект <code>User</code>. Для передачи его на страницу <code>user.jsp</code> устанавливается атрибут <code>user</code> через вызов <code>request.setAttribute("user", tom)</code>. Далее происходит перенаправление на страницу <code>user.jsp</code>. И, таким образом, страница получит данные из сервлета.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../assets/img/assets/img/java/jakarta-ee/javabeans/page-javabean.png" alt="Page JavaBean">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_пример_enterprise_javabeans">7.2. Пример Enterprise JavaBeans</h3>
<div class="paragraph">
<p>Рассмотрим простой пример использования компонента <strong>Enterprise JavaBeans</strong> с выводом стандартного сообщения типа <code>Hello World</code>. Для этого создадим три проекта:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>slon-app</code> - проект enterprise (<strong>Enterprise Application Project</strong>), связывающий модули <strong>EJB</strong> с приложениями <strong>WEB</strong></p>
</li>
<li>
<p><code>slon-module</code> - проект с компонентами <strong>EJB</strong></p>
</li>
<li>
<p><code>slon-web</code> - <strong>WEB</strong> приложение, использующее компоненты <strong>EJB</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Разработку будем вести в среде <strong>Eclipse</strong>, которая предоставляет <em>Wizard</em> для одновременного создания подобных проектов.</p>
</div>
<div class="sect3">
<h4 id="_создание_проектов">7.2.1. Создание проектов</h4>
<div class="paragraph">
<p>Выбираем <strong>Wizard</strong> и создаем структуры проектов:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>File</em> &#8594; <em>New</em> &#8594; <em>Other (Ctrl+N)</em>. В раскрывшемся окне выбираем <em>Java EE, Enterprise Application Project</em>, жмем <em>Next</em> и переходим к следующему шагу.</p>
</li>
<li>
<p>Определяем наименование проекта <code>slon-app</code>, <em>Target runtime</em> (использую JBoss 7.1) и к следующему шагу (<em>Next</em>).</p>
</li>
<li>
<p>На этом шаге в открывшемся окне можно выбрать модули из существующих или создать новые. Создаем новые - нажимаем на <em>New module &#8230;&#8203;</em>.</p>
</li>
<li>
<p>В открывшемся окне <em>New Java EE Module</em> &#8594; <em>EJB module</em> &#8594; <em>Web module</em>. Определяем наименования как <code>slon-module</code> и <code>slon-web</code>. Нажимаем на кнопку <em>Finish</em>, после чего окно закрывается, создаются новые проекты (модули), которые появляются в списке проектов. Устанавливаем флаг <em>Generate <code>application.xml</code> deployment descriptor</em> и завершаем разработку структуры проектов (жмем <em>Finish</em>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Не прилагая чрезмерных усилий создали проект <code>slon-app</code> типа <em>Enterprise Application Project</em>, включающий два проекта. На следующем скриншоте представлена структура созданных проектов в IDE Eclipse.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../assets/img/assets/img/java/jakarta-ee/javabeans/ejb.png" alt="Структуры проектов приложения Enterprise Application Project">
</div>
</div>
<div class="paragraph">
<p>Приложение <code>slon-app</code> включает только файл конфигурации приложения <code>application.xml</code>, в котором определены модули.</p>
</div>
</div>
<div class="sect3">
<h4 id="_листинг_application_xml">7.2.2. Листинг <code>application.xml</code></h4>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;application xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns="http://java.sun.com/xml/ns/javaee"
             xsi:schemaLocation="http://java.sun.com/xml/ns/javaee
               http://java.sun.com/xml/ns/javaee/application_6.xsd"
             id="Application_ID" version="6"&gt;
    &lt;display-name&gt;slon-app&lt;/display-name&gt;
    &lt;module&gt;
        &lt;web&gt;
            &lt;web-uri&gt;slon-web.war&lt;/web-uri&gt;
            &lt;context-root&gt;slon-web&lt;/context-root&gt;
        &lt;/web&gt;
    &lt;/module&gt;
    &lt;module&gt;
        &lt;ejb&gt;slon-module.jar&lt;/ejb&gt;
    &lt;/module&gt;
&lt;/application&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_создание_компонента_ejb">7.2.3. Создание компонента EJB</h4>
<div class="paragraph">
<p>Компонент <strong>EJB</strong> создаем в модуле <code>slon-module</code>. Для этого включаем в проект интерфейс <code>IHelloWorld.java</code> (<em>New</em> &#8594; <em>Interface</em>) и класс <code>HelloWorldBean</code> (<em>New</em> &#8594; <em>Class</em>), представляющий сеансовый компонент <strong>EJB</strong>.</p>
</div>
<div class="sect4">
<h5 id="_листинг_интерфейса_ihelloworld">Листинг интерфейса <code>IHelloWorld</code></h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">package modules;

import javax.ejb.Local;

@Local
public interface IHelloWorld {
    String sayHello(String name);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Интерфейс <code>IHelloWorld.java</code> включает только один метод <code>sayHello()</code> и помечен аннотацией <code>@Local</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Аннотация <code>@Local</code> к интерфейсу сообщает контейнеру, что реализация <code>IHelloWorld</code> может быть доступна локально, посредством интерфейса. В этом есть определенный смысл, если интерфейс и использующие его компоненты <strong>EJB</strong> находятся в одном и том же приложении. Аннотацию <code>@Local</code> можно опустить; в этом случае интерфейс все равно будет интерпретироваться контейнером как локальный.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_листинг_компонента_ejb">Листинг компонента EJB</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">package modules;

import javax.ejb.Stateless;

// Сеансовый компонент без сохранения состояния
@Stateless
public class HelloWorldBean implements IHelloWorld {
    @Override
    public String sayHello(String name) {
        return String.format("Hello %s, welcome to EJB 3.1!", name);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>В листинге <code>HelloWorldBean.java</code> представлен законченный, действующий компонент <strong>EJB</strong>, являющийся обычным Java-классом. Аннотация <code>@Stateless</code> обеспечивает преобразование простого Java-объекта (<strong>POJO</strong>) в полноценный сеансовый компонент <strong>EJB</strong> без сохранения состояния. Фактически, аннотации несут в себе дополнительную информацию в «форме комментария», которая добавляется в код.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Аннотация <code>@Stateless</code> сообщает контейнеру <strong>EJB</strong>, что <code>HelloWorldBean</code> является сеансовым компонентом без сохранения состояния. Контейнер приложений автоматически добавит в компонент поддержку многопоточной модели выполнения, транзакций и возможность размещения в пулах. Поддержка многопоточности и транзакций гарантируют возможность использования любых ресурсов, таких как база данных или очередь сообщений, без необходимости разработки кода для обслуживания «конкуренции» или транзакций. Поддержка размещения в пулах гарантирует надежность даже при очень высоких нагрузках. При необходимости в компонент можно также добавить поддержку дополнительных служб <strong>EJB</strong>. Например: безопасность, планирование и интерцепторы.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_аннотации_в_ejb">7.2.4. Аннотации в EJB</h4>
<div class="paragraph">
<p>Необходимо несколько слов сказать об использовании аннотаций при создании компонентов <strong>EJB</strong>. Аннотации появились в <strong>Java SE 5</strong>. До их появления единственным средством определения конфигурации приложений были файлы <strong>XML</strong>. Однако, использование файлов <strong>XML</strong> влечет за собой множество проблем:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>формат <strong>XML</strong> чересчур многословен, трудно читаем и в нем очень легко допустить ошибку;</p>
</li>
<li>
<p><strong>XML</strong> никак не поддерживает одну из сильнейших сторон Java – строгий контроль типов;</p>
</li>
<li>
<p>конфигурационные файлы <strong>XML</strong> часто получаются монолитными и они отделяют информацию о настройках от программного кода, использующего ее, что усложняет сопровождение.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Аннотации были созданы специально, чтобы ослабить эти проблемы. <strong>EJB 3</strong> стала первой распространенной технологией на основе языка Java, проложившей путь к применению аннотаций. С тех пор по ее стопам пошли многие другие технологии типа <strong>JPA</strong>, <strong>JSF</strong>, <strong>Servlets</strong>, <strong>JUnit</strong>, <strong>Spring</strong> и т.д.</p>
</div>
<div class="paragraph">
<p>Благодаря нацеленности на простоту использования в <strong>EJB 3</strong> применение аннотаций преобладает над применением конфигурации объектов в формате <strong>XML</strong>.</p>
</div>
<div class="sect4">
<h5 id="_основные_аннотации_ejb_3">Основные аннотации EJB 3</h5>
<div class="ulist">
<ul>
<li>
<p><code>@EJB</code> — помечается используемый в классе компонент <strong>EJB</strong>;</p>
</li>
<li>
<p><code>@Stateless</code> — определяется stateless session bean;</p>
</li>
<li>
<p><code>@Stateful</code> — определяется stateful session bean;</p>
</li>
<li>
<p><code>@Singleton</code> — определяется singleton session bean;</p>
</li>
<li>
<p><code>@Local</code> — определяется local session bean;</p>
</li>
<li>
<p><code>@LocalBean</code> — определяется bean, который будет использован локально, следовательно, его не нужно сериализовать;</p>
</li>
<li>
<p><code>@Remote</code> — компонент доступен через RMI (Remote Method Invocation);</p>
</li>
<li>
<p><code>@Remove</code> — помеченный данной аннотацией метод говорит контейнеру, что после его исполнения нет больше смысла хранить компонент <strong>EJB</strong>, т.е. его состояние сбрасывается;</p>
</li>
<li>
<p><code>@Entity</code> — аннотация говорит контейнеру, что класс будет сущностью <strong>БД</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Таким образом, аннотации компонентов <strong>EJB 3</strong> можно рассматривать по сути как параметры настройки, присваивающие фрагментам кода (объявление класса или метода) определенные атрибуты. Когда контейнер <strong>EJB</strong> обнаруживает эти атрибуты, он добавляет соответствующие им службы. Этот подход иначе называют «декларативным программированием» - разработчик указывает, что должно быть сделано, а система добавляет необходимый код.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_создание_web_приложения">7.2.5. Создание WEB приложения</h4>
<div class="paragraph">
<p>В WEB-приложении <code>slon-web</code> нам необходимо обратиться к компоненту <strong>EJB</strong>, определенному в другом приложении и размещенном в контейнере приложений <strong>JBoss</strong> (который я использую). Для этого создадим сервлет <code>ServletHello</code> с компонентом <strong>EJB</strong>, и страницу <code>index.jsp</code>, из которой отправим запрос сервлету.</p>
</div>
<div class="paragraph">
<p>Создаем сервлет <em>New</em> &#8594; <em>Servlet</em>. В сервлете определяем компонент <strong>EJB</strong> <code>hello</code> типа <code>IHelloWorld</code> с аннотацией <code>@EJB</code>. Контейнер приложений сам инициализирует переменную <code>hello</code> и свяжет ее с компонентом <code>HelloWorldBean</code>, реализующим интерфейс <code>IHelloWorld</code>.</p>
</div>
<div class="sect4">
<h5 id="_определение_зависимости">Определение зависимости</h5>
<div class="paragraph">
<p>На этапе разработки <strong>IDE Eclipse</strong> не определит тип интерфейса <code>IHelloWorld</code>. Поэтому необходимо к проекту <code>slon-web</code> подключить проект <code>slon-module</code>. Для этого откройте свойства проекта <em>Properties</em> и в <em>Deployment Assembly</em> подключите (<em>Add &#8230;&#8203;</em>) проект <code>slon-module</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_листинг_servlethello_java">Листинг <code>ServletHello.java</code></h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">package servlets;

import java.io.IOException;

import javax.ejb.EJB;
import javax.servlet.ServletException;
import javax.servlet.RequestDispatcher;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import modules.IHelloWorld;

public class ServletHello extends HttpServlet {
    private static final long serialVersionUID = 1L;

    @EJB
    private IHelloWorld hello;

    @Override
    protected void doPost(HttpServletRequest request,
                          HttpServletResponse response)
                          throws ServletException, IOException {
        try {
            String answer = hello.sayHello(request.getParameter("name"));
            request.getSession().setAttribute("answer", answer);
            RequestDispatcher rd;
            rd = request.getRequestDispatcher("index.jsp");
            rd.forward(request, response);
        } catch (Exception e) {
            throw new ServletException(e.getMessage());
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>В сервлете переопределен метод <code>doPost()</code>. В методу вызывается функция <code>sayHello()</code> компонента <strong>EJB</strong>, которая возвращает ответ. Сервлет размещает ответ в странице <code>index.jsp</code>.</p>
</div>
<div class="paragraph">
<p><em>Следует обратить внимание, что компонент <strong>EJB</strong> (<code>hello</code>) не инициализируется, а сразу же вызывается его метод.</em></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_листинг_index_jsp">7.2.6. Листинг <code>index.jsp</code></h4>
<div class="paragraph">
<p>Создаем страницу <code>index.jsp</code> <em>New</em> &#8594; <em>JSP File</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;%@ page language="java" contentType="text/html; charset=UTF-8"
                         pageEncoding="UTF-8"%&gt;
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
    &lt;title&gt;EJB 3.1&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h3&gt;Enterprise JavaBeans 3&lt;/h3&gt;
    &lt;p&gt;${answer}&lt;/p&gt;
    &lt;form action="sayHello" method="post"&gt;
        Введите имя : &lt;input type="text" name="name" value=""/&gt;
        &lt;input type="submit" value="OK"/&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>На странице <code>index.jsp</code> определяем поле для ответа answer и форму запроса (form). При нажатии на кнопку <em>OK</em> будет выполнено действие <code>sayHello()</code>, определенное в дескрипторе приложений <code>web.xml</code>, которое вернет ответ от сервера (сервлет &#8594; EJB).</p>
</div>
</div>
<div class="sect3">
<h4 id="_листинг_web_xml">7.2.7. Листинг <code>web.xml</code></h4>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app version= "2.5"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xmlns="http://java.sun.com/xml/ns/javaee"
         xmlns:web="http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"
         xsi:schemaLocation="http://java.sun.com/xml/ns/javaee
         http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"&gt;
    &lt;display-name&gt;Servlet Hello&lt;/display-name&gt;
    &lt;servlet&gt;
        &lt;servlet-name&gt;ServletHello&lt;/servlet-name&gt;
        &lt;servlet-class&gt;servlets.ServletHello&lt;/servlet-class&gt;
    &lt;/servlet&gt;
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;ServletHello&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/sayHello&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

    &lt;welcome-file-list&gt;
        &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;
    &lt;/welcome-file-list&gt;
&lt;/web-app&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>В дескрипторе приложения определен сервлет и действие (pattern <code>sayHello</code>), по которому он будет вызван.</p>
</div>
<div class="paragraph">
<p>На этом можно сказать разработка закончилась. Теперь осталось запустить приложение <code>slon-app</code> на исполнение (<em>Run As</em> &#8594; <em>Run on Server</em>) и увидеть следующую картинку в браузере.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../assets/img/assets/img/java/jakarta-ee/javabeans/ejb-jsp.png" alt="Интерфейс страницы JSP"></span></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Скриншот снят после ввода имени <code>Alex</code> и нажатия на кнопку <em>OK</em>, т.е. после получения ответа от сервера.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_сервер_приложений">7.2.8. Сервер приложений</h4>
<div class="paragraph">
<p>После запуска приложения <code>slon-app</code> также стартуют 2 приложения:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>slon-module</code></p>
</li>
<li>
<p><code>slon-web</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>В логах сервера приложений <strong>JBoss</strong> увидим следующую информацию:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>JNDI bindings for session bean named HelloWorldBean in deployment unit
              subdeployment "slon-module.jar" of deployment "slon-app.ear"
              are as follows:


java:global/slon-app/slon-module/HelloWorldBean!modules.IHelloWorld
java:app/slon-module/HelloWorldBean!modules.IHelloWorld
java:module/HelloWorldBean!modules.IHelloWorld
java:global/slon-app/slon-module/HelloWorldBean
java:app/slon-module/HelloWorldBean
java:module/HelloWorldBean


JNDI bindings for session bean named HelloWorldBean in deployment unit
              subdeployment "slon-web.war" of deployment "slon-app.ear"
              are as follows:


java:global/slon-app/slon-web/HelloWorldBean!modules.IHelloWorld
java:app/slon-web/HelloWorldBean!modules.IHelloWorld
java:module/HelloWorldBean!modules.IHelloWorld
java:global/slon-app/slon-web/HelloWorldBean
java:app/slon-web/HelloWorldBean
java:module/HelloWorldBean</pre>
</div>
</div>
<div class="paragraph">
<p>Таким образом, сервер приложения «принял» наш компонент <strong>EJB</strong>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_poji_pojo_и_javabean">7.3. POJI, POJO и JavaBean.</h3>
<div class="sect3">
<h4 id="_poji">7.3.1. POJI.</h4>
<div class="paragraph">
<p>Является аббревиатурой от <strong>Plain Old Java Interface</strong>, который соответствует стандартному интерфейсу Java, что означает, что эти интерфейсы находятся в контексте предоставления услуг в <strong>JEE</strong>. Например, услуга <strong>OSGI</strong> предлагается через <strong>POJI</strong> в <strong>JEE</strong>.</p>
</div>
<div class="paragraph">
<p>Другими словами, мы можем сказать, что <strong>POJI</strong> — это обычный интерфейс без какой-либо специальности, которая не унаследована от какого-либо специального <strong>API</strong>-интерфейса технологии или интерфейсов платформы.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">interface myCustomInterface {
    public void myMethod();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">interface mySecondCustomInterface extends myCustomInterface {
    public void mySecondMethod();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Оба интерфейса будут называться <strong>POJI</strong>, поскольку они не наследуют какой-либо технологический интерфейс.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">interface GFG1 extends java.rmi.Remote {
    public void myMethod();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">interface GFG2 extends java.beans.AppletInitializer {
    public void mySecondMethod();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Оба интерфейса не будут называться <strong>POJI</strong>, поскольку они наследуют специфический для технологии интерфейс.</p>
</div>
</div>
<div class="sect3">
<h4 id="_pojo">7.3.2. POJO.</h4>
<div class="paragraph">
<p>Как мы знаем, в Java <strong>POJO</strong> ссылается на простой старый объект Java. <strong>POJO</strong> и класс <strong>JavaBean</strong> в Java имеют некоторые общие черты, а именно:</p>
</div>
<div class="paragraph">
<p>Оба класса должны быть общедоступными, т.е. доступными для всех.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Свойства или переменные, определенные в обоих классах, должны быть закрытыми, то есть не могут быть доступны напрямую.</p>
</li>
<li>
<p>Оба класса должны иметь конструктор по умолчанию, т.е. не иметь аргумента конструктора.</p>
</li>
<li>
<p><code>public</code> <strong>getters</strong> и <strong>setters</strong> должны присутствовать в обоих классах для доступа к переменным/свойствам.</p>
</li>
<li>
<p>Единственное различие между обоими классами состоит в том, что Java делает объекты <strong>JavaBean</strong> сериализованными, чтобы в случае необходимости можно было сохранить состояние класса <strong>JavaBeans</strong>. Поэтому из-за этого класс <strong>JavaBeans</strong> должен реализовывать интерфейс <code>Serializable</code> или <code>Externalizable</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>В связи с этим указывается, что все <strong>JavaBean</strong>-компоненты являются <strong>POJO</strong>, но не все <strong>POJO</strong>-объекты являются <strong>JavaBean</strong>-компонентами.</p>
</div>
<div class="paragraph">
<p>Пример класса <strong>JavaBean</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class Employee implements java.io.Serializable {
    private int id;
    private String name;

    public Employee() {
    }

    public void setId(int id) {
        this.id = id;
    }

    public int getId() {
        return id;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getName() {
        return name;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Пример класса <strong>POJO</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class Employee {
    String name;
    public String id;
    private double salary;

    public Employee(String name, String id,double salary) {
        this.name = name;
        this.id = id;
        this.salary = salary;
    }

    public String getName() {
        return name;
    }

    public String getId() {
        return id;
    }

    public Double getSalary() {
        return salary;
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_служба_имен_и_каталогов_jndi">8. Служба имен и каталогов JNDI</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>JNDI</strong> (<strong>Java Naming and Directory Interface</strong>) - это <strong>API</strong> для доступа к службам имен и каталогов. <strong>Службой имен</strong>, в самом широком смысле, называют систему, управляющую отображением множества имен во множество объектов. Зная имя объекта в системе, можно получить доступ к этому объекту или ассоциировать с этим именем другой объект. Самым наглядным примером <strong>JNDI</strong> является служба доменных имен <strong>DNS</strong>, которая определяет соответствие между понятными доменными именами (например, <code>localhost</code>) и сетевым IP-адресом (<code>127.0.0.1</code>). Имея определенное доменное имя <strong>DNS</strong>, мы может узнать соответствующий ему IP-адрес.</p>
</div>
<div class="paragraph">
<p>В службе каталогов именованные объекты сгруппированы в древовидную структуру. Кроме того объекты каталога имеют атрибуты. Наиболее близким и понятным примером такой службы является файловая система. Объекты файловой системы - файлы - собраны в каталоги и идентифицируются путями, например, <code>C:\windows\notepad.exe</code>. У файлов есть атрибуты: скрытый, архивный, только для чтения и другие. Передавая файловой системе путь, можно получить содержимое соответствующего файла, записать в него какие-то данные, изменить его атрибуты.</p>
</div>
<div class="paragraph">
<p><strong>JNDI</strong> предназначен для единообразного доступа к разнообразным службам имен и каталогов, включая упомянутые выше <strong>DNS</strong> и файловую систему, а также <strong>LDAP</strong>, <strong>DataSource</strong>. Разные службы каталогов интегрируются с <strong>JNDI</strong> через интерфейс поставщика услуг <strong>SPI</strong> (<strong>Service Provider Interface</strong>).</p>
</div>
<div class="paragraph">
<p>Концепция <strong>JNDI</strong> основана на двух основных определениях :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ассоциация</strong> (<strong>binding</strong>) - соответствие <strong>JNDI</strong>-имени определенному объекту;</p>
</li>
<li>
<p><strong>контекст</strong> (<strong>context</strong>) - среда, в которой хранится набор ассоциаций между объектами и именами.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>По сути, <strong>JNDI</strong> представляет собой аналог <strong>JDBC</strong> для служб имен и каталогов. Также, как и <strong>JDBC</strong> предоставляет стандартный Java API для доступа к разнообразным базам данных, <strong>JNDI</strong> стандартизует доступ к службам имен и каталогов. На следующем рисунке представлена архитектура <strong>JNDI</strong>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../assets/img/java/jakarta-ee/jndi/jndi.png" alt="JNDI"></span></p>
</div>
<div class="paragraph">
<p>Как показано на рисунке <strong>JNDI</strong> представляет обобщенную абстракцию доступа к самым разным службам имен, таким как:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>LDAP</strong> (<strong>Lightweight Directory Access Protocol</strong>)</p>
</li>
<li>
<p><strong>DNS</strong> (<strong>Domain Naming System</strong>)</p>
</li>
<li>
<p><strong>NIS</strong> (<strong>Network Information Service</strong>)</p>
</li>
<li>
<p><strong>NDS</strong> (<strong>Novell Directory Services</strong>)</p>
</li>
<li>
<p><strong>RMI</strong> (<strong>Remote Method Invocation</strong>)</p>
</li>
<li>
<p><strong>CORBA</strong> (<strong>Common Object Request Broker Architecture</strong>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Получив экземпляр контекста <strong>JNDI</strong>, его можно использовать для поиска ресурсов в любой службе имен, доступной этому контексту. За кулисами <strong>JNDI</strong> взаимодействует со всеми доступными ей службами имен, передавая им имена ресурсов, которые требуется найти и выясняя, где в действительности находится искомый ресурс.</p>
</div>
<div class="sect2">
<h3 id="_инициализация_контекста_jndi">8.1. Инициализация контекста JNDI</h3>
<div class="paragraph">
<p>Чтобы воспользоваться хранящимся в контексте <strong>JNDI</strong> ресурсом, необходимо инициализировать контекст <code>javax.naming.Context</code> и найти требуемый ресурс. Инициализация <code>Context</code> напоминает настройку драйвера <strong>JDBC</strong> при подключении к серверу базы данных.</p>
</div>
<div class="paragraph">
<p>Чтобы подключиться к службе имен или каталогов, необходимо получить библиотеки <strong>JNDI</strong> для этой службы. Это напоминает выбор соответствующего драйвера <strong>JDBC</strong>. Если требуется подключиться к <strong>LDAP</strong>, <strong>DNS</strong> или файловой системе компьютера, необходимо получить провайдера для соответствующей службы соответственно.</p>
</div>
<div class="paragraph">
<p>При работе в окружении Java EE (WEB), сервер приложений загружает все необходимые библиотеки для доступа к окружению <strong>JNDI</strong>. В противном случае необходимо настроить свое приложение, указав, какие библиотеки <strong>JNDI</strong> оно должно использовать. Сделать это можно, например, создав объект <code>Properties</code> и передав его конструктору <code>InitialContext</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">String CONTEXT = "oracle.j2ee.rmi.RMIInitialContextFactory";
String URL = "ormi://&lt;host&gt;:&lt;port&gt;/app";
String LOGIN = "SCOTT";
String PASSWORD = "TIGER";

Properties properties = new Properties();

properties.put(Context.INITIAL_CONTEXT_FACTORY, CONTEXT );
properties.put(Context.PROVIDER_URL , URL );
properties.put(Context.SECURITY_PRINCIPAL , LOGIN );
properties.put(Context.SECURITY_CREDENTIALS , PASSWORD);

Context context = new InitialContext(properties);</code></pre>
</div>
</div>
<div class="paragraph">
<p>В представленном примере выполняется настройка объекта <code>Properties</code> для доступа к дереву <strong>JNDI</strong> удаленного сервера БД <em>Oracle</em>. Необходимо принять во внимание, что параметры подключения к <strong>JNDI</strong> зависят от конкретного производителя и представленный пример не является универсальным. Следует обращаться к документации с описанием своего сервера приложений, чтобы узнать, как организовать удаленное подключение.</p>
</div>
<div class="paragraph">
<p>Другой способ определения настроек <strong>JNDI</strong> связан с созданием файла <code>jndi.properties</code> и определением пути в <strong>CLASSPATH</strong> приложения. Содержимое файла настроек представляет те же самые пары имя/значение, что помещаются в объект <code>Properties</code>. После этого данный файл будет использоваться автоматически при создании контекста вызовом <code>InitialContext</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">Context context = new InitialContext();</code></pre>
</div>
</div>
<div class="paragraph">
<p>В таблице перечислены наиболее часто используемые свойства <strong>JNDI</strong>, необходимые для подключения к удаленному провайдеру службы <strong>JNDI</strong>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Свойство</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Описание</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Пример</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.naming.factory.initial Context.INITIAL_CONTEXT_FACTORY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Имя фабричного класса, который будет использоваться для создания контекста.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>oracle.j2ee.rmi.RMIInitialContextFactory</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.naming.provider.url Context.PROVIDER_URL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Адрес URL службы JNDI - определение расположения службы (формат описания URL зависит от службы).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ormi://localhost:98765/chapter1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.naming.security.principal Context.SECURITY_PRINCIPAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Идентификационная информация (учетная запись), позволяющая аутентифицировать вызывающую программу в службе JNDI.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SCOTT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.naming.security.credentials Context.SECURITY_CREDENTIALS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Используемый для аутентификации пароль пользователя.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TIGER</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>javax.naming.Context.INITIAL_CONTEXT_FACTORY</code> - определяет класс, который будет формировать экземпляр <strong>JNDI</strong> <code>Context</code>. Если работаете с <strong>DNS</strong>, то необходимо указывать класс, который создает <code>Context</code> для взаимодействия с <strong>DNS</strong> сервером (см. пример ниже).</p>
</div>
</div>
<div class="sect2">
<h3 id="_поиск_ресурсов_в_jndi_lookup">8.2. Поиск ресурсов в JNDI, lookup</h3>
<div class="paragraph">
<p>Метод <code>lookup()</code> интерфейса <code>javax.naming.Context`</code> возвращает ресурс с именем name, который следует привести к требуемому типу.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">Object lookup (String name)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Если в аргументе <code>name</code> передать пустую строку, то возвращается новый экземпляр <code>Context</code>.</p>
</div>
<div class="paragraph">
<p>Чтобы отыскать ресурс, необходимо знать его имя. Допустим, что в JNDI компонент <code>BidService</code> зарегистрирован под именем <code>/ejb/bid/BidService</code>. Чтобы найти его, можно выполнить поиск непосредственно :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">Context context = new InitialContext();
BidService service = (BidService) context.lookup("/ejb/bid/BidService");</code></pre>
</div>
</div>
<div class="paragraph">
<p>или последовательно :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">Context newContext = new InitialContext();
Context bidContext = (Context) newContext.lookup("/ejb/bid/");
BidService service = (BidService) bidContext.lookup("BidService");</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_пример_jndi">8.3. Пример JNDI</h3>
<div class="paragraph">
<p>Широкое распространение <strong>JNDI</strong> получила при подключении к серверу БД. Пример использования <strong>JNDI</strong> для настройки подключения <code>DataSource</code> к серверу базы <em>Oracle</em> в сервере приложений <em>JBoss</em> рассмотрен <a href="http://java-online.ru/datasource.xhtml">здесь</a>.</p>
</div>
<div class="paragraph">
<p>Ниже приведен пример, в котором используется <strong>JNDI</strong> для просмотра содержимого корня контекста <strong>DNS</strong> сервера. В примере использован открытый адрес <strong>URL</strong> сайта <em>Yandex</em>, размещенный в <em>Википедии</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import javax.naming.Context;
import javax.naming.NameClassPair;
import javax.naming.InitialContext;
import javax.naming.NamingException;
import javax.naming.NamingEnumeration;

import java.util.Properties;

public class ExampleJNDI {
	static String DNS_CONTEXT = "com.sun.jndi.dns.DnsContextFactory";
	static String DNS_URL = "dns://77.88.8.8"; // yandex

	ExampleJNDI() {
		Properties props = new Properties ();
		props.put (Context.INITIAL_CONTEXT_FACTORY, DNS_CONTEXT);
		props.put (Context.PROVIDER_URL , DNS_URL );
		try {
			Context context = new InitialContext (props);
			NamingEnumeration&lt;NameClassPair&gt; names = context.list ("");
			while ( names.hasMoreElements ())
			System.out.println (names.nextElement());
		} catch (NamingException e) {
			e.printStackTrace();
		}
	}

	public static void main(String[] args) {
		new ExampleJNDI();
		System.exit(0);
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>В результате работы программы в консоли можно увидеть следующие сообщения:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="out">ltd: javax.naming.directory.DirContext
casino: javax.naming.directory.DirContext
alfaromeo: javax.naming.directory.DirContext
amsterdam: javax.naming.directory.DirContext
cat: javax.naming.directory.DirContext
car: javax.naming.directory.DirContext
photography: javax.naming.directory.DirContext
cam: javax.naming.directory.DirContext
aquarelle: javax.naming.directory.DirContext
theatre: javax.naming.directory.DirContext
media: javax.naming.directory.DirContext
total: javax.naming.directory.DirContext
diet: javax.naming.directory.DirContext
today: javax.naming.directory.DirContext
actor: javax.naming.directory.DirContext
fans: javax.naming.directory.DirContext
career: javax.naming.directory.DirContext
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>В <strong>Enterprise JavaBeans</strong> <strong>JNDI</strong> используется для нахождения всех видов ресурсов, включая компонент <a href="http://java-online.ru/ejb.xhtml">EJB</a>, пул соединений с базой данных, информацию об окружении и многое другое. Таким образом, из окна контейнера <strong>EJB</strong> можно «увидеть остальной мир» посредством <strong>JNDI</strong>. Клиентское приложение также использует <strong>JNDI</strong> для получения соединения с фабрикой <strong>EJB</strong>.</p>
</div>
<div class="paragraph">
<p>Что представляет собой поставщик услуг при использовании <strong>JNDI</strong> с <strong>EJB</strong>? Ответ заключается в том, что контейнер <strong>EJB</strong> определяет свою собственную службу <strong>JNDI</strong>, специализированную для работы с ресурсами, управляемыми контейнером. Иными словами, служба <strong>JNDI</strong> в этом случае позволяет клиентам и <strong>Enterprise JavaBeans</strong> находить ресурсы по <strong>JNDI</strong> именам. Следует помнить, что когда вы стартует Ваш контейнер <strong>EJB</strong>, то также неявно запускается <strong>EJB</strong> <strong>JNDI</strong> служба, которая доступна через стандартный <strong>JNDI API</strong>. О формате именования компонентов <strong>EJB</strong> подробно представлено <a href="http://java-online.ru/ejb.xhtml#jndi-ejb">здесь</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-06-03 03:53:52 UTC
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.min.js"></script>
</body>
</html>