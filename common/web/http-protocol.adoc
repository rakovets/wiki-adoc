= HTTP protocol
:imagesdir: ../../assets/img/common/web/

Наиболее распространенный протокол *HTTP* (*Hyper Text Transfert Protocol*) определяет взаимодействие двух программ, клиента и сервера, которые могут быть запущены на разных и удаленных друг от друга машинах. *Client* является приложение, которое пользуется каким-то сервисом, предоставляемым *server*, обычно размещенном на удаленном компьютере. Клиент должен подключиться к удаленному серверу, который постоянно находится в режиме ожидания соединения. После этого они могут обмениваться информацией.

*HTTP* использует протокол *TCP/IP*.

Распределение протоколов по уровням модели *TCP/IP*:

|===
|Layer|Protocol and Service
|Application|*HTTP*, *RTP*, *FTP*, *DNS*
|Transport| *TCP*, *UDP*, *SCTP*, *DCCP*
|Internet|*IP*, *ICMP*, *ARP*, *IGMP* based on *IP*
|Network Access|Ethernet, *IEEE* 802.11 Wireless Ethernet, *SLIP*, Token Ring, *ATM* и *MPLS*
|===

Протокол *HTTP* располагается на прикладном уровне и использует для собственной реализации протоколы более низких уровней. Основой *HTTP* является протокол транспортного уровня *TCP*.

== Основные свойства

*HTTP* является простым, но в то же время сильным протоколом благодаря тёрм свойствам:

* *HTTP не зависит от соединения*.
Клиент HTTP (чаще всего, барузер), отправляет HTTP запрос и, после отправки запроса, отсоединяется от сервера и ждёт ответа. Сервер обрабатывает запрос и создаёт новое соединение с клиентом для отправки ответа.

* *HTTP не привязан к конкретному типу данных*.
Это означает, что с помощью HTTP мы можем передавать любой тип данных, при условии, что и клиент и сервер “умеют” работать с данным типом данных. Сервер и клиент должны определить тип контента с помощью определённого типа MIME.

* *HTTP взаимодейтсвует только через соединение*.
Клиент и сервер могут взаимодейтсвовать друг с другом только с помощью запроса. После этого они “забывают” друг о друге. Из-за этой особенности протокола ни клиент. ни сервер не могут получить информацию “за пределами” запроса.

*HTTP/1.0* использует соединение для каждого цикла “запрос/ответ”.

*HTTP/1.1* может использовать один или несколько циклов “запрос-ответ” внутри одного соединения.

== Базовая архитектура

В крайне упрозённой форме, архитектуру HTTP можно предстваить следующим образом:

image:http-archetecture.png[http archetecture]

Протокол HTTP основан клиент-серверной архитектуре, в которой браузер, *поисковик* и т.д. действует как *клиент*, а веб-сервер – как *сервер*.

=== Клиент

Клиент HTTP отправляет запрос на сервер в виде метода запроса, URL и версии протокола, после которых идёт *MIME* сообщение, которое и содержит модификаторы запроса, информацию о клиенте и, возможно контент соединения *TCP/IP*.

=== Сервер

Сервер *HTTP* отвечает на запрос строкой статуса, которая включает в себя версию протокола и код успешного выполнения, либо ошибки, после которого идёт сообщение MIME, содержащее информацию о сервере, мета-информацию о сущности и, возможно, контент самой сущности.

== HTTP methods

Протокол HTTP был разработан для обмена файлами, поэтому он имеет несколько стандартных команд для этого, которые часто называют методами:

* `GET`
* `POST`
* `PUT`
* `DELETE`
* `OPTIONS`
* `HEAD`
* `PATCH`
* `TRACE`
* `LINK`
* `UNLINK`
* `CONNECT`

На практике чаще всего используют:

* `GET` предназначен для получения файла по запросу (URL).  Запрос файла предполагает, что ничего кроме самого запроса на сервер не пересылается. При этом считается нормальным кэшировать результаты (ответы) таких запросов. Яркий пример такого кэширования – это загрузка картинок браузерами
* `PUT` предназначен для добавления файла на сервер. При этом ожидается, что путем файла будет путь, указанный в URL. Тело запроса должно содержать такой файл
* `POST` предназначен для обновления файла на сервере. И в запросе, и в ответе пересылаются данные/файлы
* `DELETE` предназначен для удаления файла по его URL

image:http-methods.png[http methods]

Фактически веб отошел от понимания URL как пути к файлу и стал рассматривать его как запрос.

== cURL

Для того что бы делать запросы на какой-то сервис нужен HTTP-client. В качестве HTTP-clienta удобно использовать link:https://curl.haxx.se/[*cURL*].

Примеры использования cURL:

[source, sh]
----
curl -X GET https://www.yourwebsite.com/users/1

curl -X POST https://www.yourwebsite.com/users/ -d 'username=yourusername&password=yourpassword'

curl -X PUT https://www.yourwebsite.com/users/1 -d 'username=yourusername&password=yourpassword&age=25'

curl -X DELETE https://www.yourwebsite.com/users/1
----
